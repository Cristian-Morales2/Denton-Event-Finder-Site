import { Policy, PolicyStatement } from 'aws-cdk-lib/aws-iam';
import { Stack } from 'aws-cdk-lib';
import { AmplifyFault, AmplifyUserError } from '@aws-amplify/platform-core';
/**
 * Generates IAM policies scoped to a single userpool.
 */
export class UserPoolAccessPolicyFactory {
    userpool;
    namePrefix = 'userpoolAccess';
    stack;
    policyCount = 1;
    /**
     * Instantiate with the userpool to generate policies for
     */
    constructor(userpool) {
        this.userpool = userpool;
        this.stack = Stack.of(userpool);
    }
    createPolicy = (actions) => {
        if (actions.length === 0) {
            throw new AmplifyUserError('EmptyPolicyError', {
                message: 'At least one action must be specified.',
                resolution: 'Ensure all resource access rules specify at least one action.',
            });
        }
        const policyActions = new Set(actions.flatMap((action) => iamActionMap[action]));
        if (policyActions.size === 0) {
            throw new AmplifyFault('EmptyPolicyFault', {
                message: 'Failed to construct valid policy to access UserPool',
            });
        }
        const policy = new Policy(this.stack, `${this.namePrefix}${this.policyCount++}`, {
            statements: [
                new PolicyStatement({
                    actions: [...policyActions],
                    resources: [this.userpool.userPoolArn],
                }),
            ],
        });
        return policy;
    };
}
const iamActionMap = {
    manageUsers: [
        'cognito-idp:AdminConfirmSignUp',
        'cognito-idp:AdminCreateUser',
        'cognito-idp:AdminDeleteUser',
        'cognito-idp:AdminDeleteUserAttributes',
        'cognito-idp:AdminDisableUser',
        'cognito-idp:AdminEnableUser',
        'cognito-idp:AdminGetUser',
        'cognito-idp:AdminListGroupsForUser',
        'cognito-idp:AdminRespondToAuthChallenge',
        'cognito-idp:AdminSetUserMFAPreference',
        'cognito-idp:AdminSetUserSettings',
        'cognito-idp:AdminUpdateUserAttributes',
        'cognito-idp:AdminUserGlobalSignOut',
    ],
    manageGroupMembership: [
        'cognito-idp:AdminAddUserToGroup',
        'cognito-idp:AdminRemoveUserFromGroup',
    ],
    manageGroups: [
        'cognito-idp:GetGroup',
        'cognito-idp:ListGroups',
        'cognito-idp:CreateGroup',
        'cognito-idp:DeleteGroup',
        'cognito-idp:UpdateGroup',
    ],
    manageUserDevices: [
        'cognito-idp:AdminForgetDevice',
        'cognito-idp:AdminGetDevice',
        'cognito-idp:AdminListDevices',
        'cognito-idp:AdminUpdateDeviceStatus',
    ],
    managePasswordRecovery: [
        'cognito-idp:AdminResetUserPassword',
        'cognito-idp:AdminSetUserPassword',
    ],
    addUserToGroup: ['cognito-idp:AdminAddUserToGroup'],
    createUser: ['cognito-idp:AdminCreateUser'],
    deleteUser: ['cognito-idp:AdminDeleteUser'],
    deleteUserAttributes: ['cognito-idp:AdminDeleteUserAttributes'],
    disableUser: ['cognito-idp:AdminDisableUser'],
    enableUser: ['cognito-idp:AdminEnableUser'],
    forgetDevice: ['cognito-idp:AdminForgetDevice'],
    getDevice: ['cognito-idp:AdminGetDevice'],
    getUser: ['cognito-idp:AdminGetUser'],
    listDevices: ['cognito-idp:AdminListDevices'],
    listGroupsForUser: ['cognito-idp:AdminListGroupsForUser'],
    removeUserFromGroup: ['cognito-idp:AdminRemoveUserFromGroup'],
    resetUserPassword: ['cognito-idp:AdminResetUserPassword'],
    setUserMfaPreference: ['cognito-idp:AdminSetUserMFAPreference'],
    setUserPassword: ['cognito-idp:AdminSetUserPassword'],
    setUserSettings: ['cognito-idp:AdminSetUserSettings'],
    updateDeviceStatus: ['cognito-idp:AdminUpdateDeviceStatus'],
    updateUserAttributes: ['cognito-idp:AdminUpdateUserAttributes'],
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlcnBvb2xfYWNjZXNzX3BvbGljeV9mYWN0b3J5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3VzZXJwb29sX2FjY2Vzc19wb2xpY3lfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsTUFBTSxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzlELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDcEMsT0FBTyxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRzVFOztHQUVHO0FBQ0gsTUFBTSxPQUFPLDJCQUEyQjtJQVNUO0lBUlosVUFBVSxHQUFHLGdCQUFnQixDQUFDO0lBQzlCLEtBQUssQ0FBUTtJQUV0QixXQUFXLEdBQUcsQ0FBQyxDQUFDO0lBRXhCOztPQUVHO0lBQ0gsWUFBNkIsUUFBbUI7UUFBbkIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUM5QyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVELFlBQVksR0FBRyxDQUFDLE9BQXFCLEVBQUUsRUFBRTtRQUN2QyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3hCLE1BQU0sSUFBSSxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRTtnQkFDN0MsT0FBTyxFQUFFLHdDQUF3QztnQkFDakQsVUFBVSxFQUNSLCtEQUErRDthQUNsRSxDQUFDLENBQUM7U0FDSjtRQUVELE1BQU0sYUFBYSxHQUFHLElBQUksR0FBRyxDQUMzQixPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FDbEQsQ0FBQztRQUVGLElBQUksYUFBYSxDQUFDLElBQUksS0FBSyxDQUFDLEVBQUU7WUFDNUIsTUFBTSxJQUFJLFlBQVksQ0FBQyxrQkFBa0IsRUFBRTtnQkFDekMsT0FBTyxFQUFFLHFEQUFxRDthQUMvRCxDQUFDLENBQUM7U0FDSjtRQUVELE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxDQUN2QixJQUFJLENBQUMsS0FBSyxFQUNWLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUUsRUFDekM7WUFDRSxVQUFVLEVBQUU7Z0JBQ1YsSUFBSSxlQUFlLENBQUM7b0JBQ2xCLE9BQU8sRUFBRSxDQUFDLEdBQUcsYUFBYSxDQUFDO29CQUMzQixTQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztpQkFDdkMsQ0FBQzthQUNIO1NBQ0YsQ0FDRixDQUFDO1FBRUYsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQyxDQUFDO0NBQ0g7QUFNRCxNQUFNLFlBQVksR0FBaUI7SUFDakMsV0FBVyxFQUFFO1FBQ1gsZ0NBQWdDO1FBQ2hDLDZCQUE2QjtRQUM3Qiw2QkFBNkI7UUFDN0IsdUNBQXVDO1FBQ3ZDLDhCQUE4QjtRQUM5Qiw2QkFBNkI7UUFDN0IsMEJBQTBCO1FBQzFCLG9DQUFvQztRQUNwQyx5Q0FBeUM7UUFDekMsdUNBQXVDO1FBQ3ZDLGtDQUFrQztRQUNsQyx1Q0FBdUM7UUFDdkMsb0NBQW9DO0tBQ3JDO0lBQ0QscUJBQXFCLEVBQUU7UUFDckIsaUNBQWlDO1FBQ2pDLHNDQUFzQztLQUN2QztJQUNELFlBQVksRUFBRTtRQUNaLHNCQUFzQjtRQUN0Qix3QkFBd0I7UUFDeEIseUJBQXlCO1FBQ3pCLHlCQUF5QjtRQUN6Qix5QkFBeUI7S0FDMUI7SUFDRCxpQkFBaUIsRUFBRTtRQUNqQiwrQkFBK0I7UUFDL0IsNEJBQTRCO1FBQzVCLDhCQUE4QjtRQUM5QixxQ0FBcUM7S0FDdEM7SUFDRCxzQkFBc0IsRUFBRTtRQUN0QixvQ0FBb0M7UUFDcEMsa0NBQWtDO0tBQ25DO0lBQ0QsY0FBYyxFQUFFLENBQUMsaUNBQWlDLENBQUM7SUFDbkQsVUFBVSxFQUFFLENBQUMsNkJBQTZCLENBQUM7SUFDM0MsVUFBVSxFQUFFLENBQUMsNkJBQTZCLENBQUM7SUFDM0Msb0JBQW9CLEVBQUUsQ0FBQyx1Q0FBdUMsQ0FBQztJQUMvRCxXQUFXLEVBQUUsQ0FBQyw4QkFBOEIsQ0FBQztJQUM3QyxVQUFVLEVBQUUsQ0FBQyw2QkFBNkIsQ0FBQztJQUMzQyxZQUFZLEVBQUUsQ0FBQywrQkFBK0IsQ0FBQztJQUMvQyxTQUFTLEVBQUUsQ0FBQyw0QkFBNEIsQ0FBQztJQUN6QyxPQUFPLEVBQUUsQ0FBQywwQkFBMEIsQ0FBQztJQUNyQyxXQUFXLEVBQUUsQ0FBQyw4QkFBOEIsQ0FBQztJQUM3QyxpQkFBaUIsRUFBRSxDQUFDLG9DQUFvQyxDQUFDO0lBQ3pELG1CQUFtQixFQUFFLENBQUMsc0NBQXNDLENBQUM7SUFDN0QsaUJBQWlCLEVBQUUsQ0FBQyxvQ0FBb0MsQ0FBQztJQUN6RCxvQkFBb0IsRUFBRSxDQUFDLHVDQUF1QyxDQUFDO0lBQy9ELGVBQWUsRUFBRSxDQUFDLGtDQUFrQyxDQUFDO0lBQ3JELGVBQWUsRUFBRSxDQUFDLGtDQUFrQyxDQUFDO0lBQ3JELGtCQUFrQixFQUFFLENBQUMscUNBQXFDLENBQUM7SUFDM0Qsb0JBQW9CLEVBQUUsQ0FBQyx1Q0FBdUMsQ0FBQztDQUNoRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSVVzZXJQb29sIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWNvZ25pdG8nO1xuaW1wb3J0IHsgUG9saWN5LCBQb2xpY3lTdGF0ZW1lbnQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCB7IFN0YWNrIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0IHsgQW1wbGlmeUZhdWx0LCBBbXBsaWZ5VXNlckVycm9yIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsYXRmb3JtLWNvcmUnO1xuaW1wb3J0IHsgQXV0aEFjdGlvbiB9IGZyb20gJy4vdHlwZXMuanMnO1xuXG4vKipcbiAqIEdlbmVyYXRlcyBJQU0gcG9saWNpZXMgc2NvcGVkIHRvIGEgc2luZ2xlIHVzZXJwb29sLlxuICovXG5leHBvcnQgY2xhc3MgVXNlclBvb2xBY2Nlc3NQb2xpY3lGYWN0b3J5IHtcbiAgcHJpdmF0ZSByZWFkb25seSBuYW1lUHJlZml4ID0gJ3VzZXJwb29sQWNjZXNzJztcbiAgcHJpdmF0ZSByZWFkb25seSBzdGFjazogU3RhY2s7XG5cbiAgcHJpdmF0ZSBwb2xpY3lDb3VudCA9IDE7XG5cbiAgLyoqXG4gICAqIEluc3RhbnRpYXRlIHdpdGggdGhlIHVzZXJwb29sIHRvIGdlbmVyYXRlIHBvbGljaWVzIGZvclxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSB1c2VycG9vbDogSVVzZXJQb29sKSB7XG4gICAgdGhpcy5zdGFjayA9IFN0YWNrLm9mKHVzZXJwb29sKTtcbiAgfVxuXG4gIGNyZWF0ZVBvbGljeSA9IChhY3Rpb25zOiBBdXRoQWN0aW9uW10pID0+IHtcbiAgICBpZiAoYWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yKCdFbXB0eVBvbGljeUVycm9yJywge1xuICAgICAgICBtZXNzYWdlOiAnQXQgbGVhc3Qgb25lIGFjdGlvbiBtdXN0IGJlIHNwZWNpZmllZC4nLFxuICAgICAgICByZXNvbHV0aW9uOlxuICAgICAgICAgICdFbnN1cmUgYWxsIHJlc291cmNlIGFjY2VzcyBydWxlcyBzcGVjaWZ5IGF0IGxlYXN0IG9uZSBhY3Rpb24uJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHBvbGljeUFjdGlvbnMgPSBuZXcgU2V0KFxuICAgICAgYWN0aW9ucy5mbGF0TWFwKChhY3Rpb24pID0+IGlhbUFjdGlvbk1hcFthY3Rpb25dKVxuICAgICk7XG5cbiAgICBpZiAocG9saWN5QWN0aW9ucy5zaXplID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgQW1wbGlmeUZhdWx0KCdFbXB0eVBvbGljeUZhdWx0Jywge1xuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNvbnN0cnVjdCB2YWxpZCBwb2xpY3kgdG8gYWNjZXNzIFVzZXJQb29sJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHBvbGljeSA9IG5ldyBQb2xpY3koXG4gICAgICB0aGlzLnN0YWNrLFxuICAgICAgYCR7dGhpcy5uYW1lUHJlZml4fSR7dGhpcy5wb2xpY3lDb3VudCsrfWAsXG4gICAgICB7XG4gICAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgICBuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICAgIGFjdGlvbnM6IFsuLi5wb2xpY3lBY3Rpb25zXSxcbiAgICAgICAgICAgIHJlc291cmNlczogW3RoaXMudXNlcnBvb2wudXNlclBvb2xBcm5dLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgfVxuICAgICk7XG5cbiAgICByZXR1cm4gcG9saWN5O1xuICB9O1xufVxuXG50eXBlIElhbUFjdGlvbk1hcCA9IHtcbiAgW2FjdGlvbiBpbiBBdXRoQWN0aW9uXTogc3RyaW5nW107XG59O1xuXG5jb25zdCBpYW1BY3Rpb25NYXA6IElhbUFjdGlvbk1hcCA9IHtcbiAgbWFuYWdlVXNlcnM6IFtcbiAgICAnY29nbml0by1pZHA6QWRtaW5Db25maXJtU2lnblVwJyxcbiAgICAnY29nbml0by1pZHA6QWRtaW5DcmVhdGVVc2VyJyxcbiAgICAnY29nbml0by1pZHA6QWRtaW5EZWxldGVVc2VyJyxcbiAgICAnY29nbml0by1pZHA6QWRtaW5EZWxldGVVc2VyQXR0cmlidXRlcycsXG4gICAgJ2NvZ25pdG8taWRwOkFkbWluRGlzYWJsZVVzZXInLFxuICAgICdjb2duaXRvLWlkcDpBZG1pbkVuYWJsZVVzZXInLFxuICAgICdjb2duaXRvLWlkcDpBZG1pbkdldFVzZXInLFxuICAgICdjb2duaXRvLWlkcDpBZG1pbkxpc3RHcm91cHNGb3JVc2VyJyxcbiAgICAnY29nbml0by1pZHA6QWRtaW5SZXNwb25kVG9BdXRoQ2hhbGxlbmdlJyxcbiAgICAnY29nbml0by1pZHA6QWRtaW5TZXRVc2VyTUZBUHJlZmVyZW5jZScsXG4gICAgJ2NvZ25pdG8taWRwOkFkbWluU2V0VXNlclNldHRpbmdzJyxcbiAgICAnY29nbml0by1pZHA6QWRtaW5VcGRhdGVVc2VyQXR0cmlidXRlcycsXG4gICAgJ2NvZ25pdG8taWRwOkFkbWluVXNlckdsb2JhbFNpZ25PdXQnLFxuICBdLFxuICBtYW5hZ2VHcm91cE1lbWJlcnNoaXA6IFtcbiAgICAnY29nbml0by1pZHA6QWRtaW5BZGRVc2VyVG9Hcm91cCcsXG4gICAgJ2NvZ25pdG8taWRwOkFkbWluUmVtb3ZlVXNlckZyb21Hcm91cCcsXG4gIF0sXG4gIG1hbmFnZUdyb3VwczogW1xuICAgICdjb2duaXRvLWlkcDpHZXRHcm91cCcsXG4gICAgJ2NvZ25pdG8taWRwOkxpc3RHcm91cHMnLFxuICAgICdjb2duaXRvLWlkcDpDcmVhdGVHcm91cCcsXG4gICAgJ2NvZ25pdG8taWRwOkRlbGV0ZUdyb3VwJyxcbiAgICAnY29nbml0by1pZHA6VXBkYXRlR3JvdXAnLFxuICBdLFxuICBtYW5hZ2VVc2VyRGV2aWNlczogW1xuICAgICdjb2duaXRvLWlkcDpBZG1pbkZvcmdldERldmljZScsXG4gICAgJ2NvZ25pdG8taWRwOkFkbWluR2V0RGV2aWNlJyxcbiAgICAnY29nbml0by1pZHA6QWRtaW5MaXN0RGV2aWNlcycsXG4gICAgJ2NvZ25pdG8taWRwOkFkbWluVXBkYXRlRGV2aWNlU3RhdHVzJyxcbiAgXSxcbiAgbWFuYWdlUGFzc3dvcmRSZWNvdmVyeTogW1xuICAgICdjb2duaXRvLWlkcDpBZG1pblJlc2V0VXNlclBhc3N3b3JkJyxcbiAgICAnY29nbml0by1pZHA6QWRtaW5TZXRVc2VyUGFzc3dvcmQnLFxuICBdLFxuICBhZGRVc2VyVG9Hcm91cDogWydjb2duaXRvLWlkcDpBZG1pbkFkZFVzZXJUb0dyb3VwJ10sXG4gIGNyZWF0ZVVzZXI6IFsnY29nbml0by1pZHA6QWRtaW5DcmVhdGVVc2VyJ10sXG4gIGRlbGV0ZVVzZXI6IFsnY29nbml0by1pZHA6QWRtaW5EZWxldGVVc2VyJ10sXG4gIGRlbGV0ZVVzZXJBdHRyaWJ1dGVzOiBbJ2NvZ25pdG8taWRwOkFkbWluRGVsZXRlVXNlckF0dHJpYnV0ZXMnXSxcbiAgZGlzYWJsZVVzZXI6IFsnY29nbml0by1pZHA6QWRtaW5EaXNhYmxlVXNlciddLFxuICBlbmFibGVVc2VyOiBbJ2NvZ25pdG8taWRwOkFkbWluRW5hYmxlVXNlciddLFxuICBmb3JnZXREZXZpY2U6IFsnY29nbml0by1pZHA6QWRtaW5Gb3JnZXREZXZpY2UnXSxcbiAgZ2V0RGV2aWNlOiBbJ2NvZ25pdG8taWRwOkFkbWluR2V0RGV2aWNlJ10sXG4gIGdldFVzZXI6IFsnY29nbml0by1pZHA6QWRtaW5HZXRVc2VyJ10sXG4gIGxpc3REZXZpY2VzOiBbJ2NvZ25pdG8taWRwOkFkbWluTGlzdERldmljZXMnXSxcbiAgbGlzdEdyb3Vwc0ZvclVzZXI6IFsnY29nbml0by1pZHA6QWRtaW5MaXN0R3JvdXBzRm9yVXNlciddLFxuICByZW1vdmVVc2VyRnJvbUdyb3VwOiBbJ2NvZ25pdG8taWRwOkFkbWluUmVtb3ZlVXNlckZyb21Hcm91cCddLFxuICByZXNldFVzZXJQYXNzd29yZDogWydjb2duaXRvLWlkcDpBZG1pblJlc2V0VXNlclBhc3N3b3JkJ10sXG4gIHNldFVzZXJNZmFQcmVmZXJlbmNlOiBbJ2NvZ25pdG8taWRwOkFkbWluU2V0VXNlck1GQVByZWZlcmVuY2UnXSxcbiAgc2V0VXNlclBhc3N3b3JkOiBbJ2NvZ25pdG8taWRwOkFkbWluU2V0VXNlclBhc3N3b3JkJ10sXG4gIHNldFVzZXJTZXR0aW5nczogWydjb2duaXRvLWlkcDpBZG1pblNldFVzZXJTZXR0aW5ncyddLFxuICB1cGRhdGVEZXZpY2VTdGF0dXM6IFsnY29nbml0by1pZHA6QWRtaW5VcGRhdGVEZXZpY2VTdGF0dXMnXSxcbiAgdXBkYXRlVXNlckF0dHJpYnV0ZXM6IFsnY29nbml0by1pZHA6QWRtaW5VcGRhdGVVc2VyQXR0cmlidXRlcyddLFxufTtcbiJdfQ==