"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AmplifyError = void 0;
const _1 = require(".");
/**
 * Base class for all Amplify errors or faults
 */
class AmplifyError extends Error {
    name;
    classification;
    options;
    cause;
    serializedError;
    message;
    resolution;
    details;
    link;
    code;
    /**
     * You should use AmplifyUserError or AmplifyLibraryFault to throw an error.
     * @param name - a user friendly name for the exception
     * @param classification - LibraryFault or UserError
     * @param options - error stack, resolution steps, details, or help links
     * @param cause If you are throwing this exception from within a catch block,
     * you must provide the exception that was caught.
     * @example
     * try {
     *  ...
     * } catch (error){
     *    throw new AmplifyError(...,...,error);
     * }
     */
    constructor(name, classification, options, cause) {
        // If an AmplifyError was already thrown, we must allow it to reach the user.
        // This ensures that resolution steps, and the original error are bubbled up.
        super(options.message, { cause });
        this.name = name;
        this.classification = classification;
        this.options = options;
        this.cause = cause;
        // https://github.com/Microsoft/TypeScript-wiki/blob/main/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work
        Object.setPrototypeOf(this, AmplifyError.prototype);
        this.message = options.message;
        this.details = options.details;
        this.resolution = options.resolution;
        this.code = options.code;
        this.link = options.link;
        if (cause && cause instanceof AmplifyError) {
            cause.serializedError = undefined;
        }
        this.serializedError = JSON.stringify({
            name,
            classification,
            options,
            cause,
        }, errorSerializer);
    }
    static fromStderr = (_stderr) => {
        /**
         * `["']?serializedError["']?:[ ]?` captures the start of the serialized error. The quotes depend on which OS is being used
         * `(?:`(.+?)`|'(.+?)'|"((?:\\"|[^"])*?)")` captures the rest of the serialized string enclosed in either single quote,
         * double quotes or back-ticks.
         */
        const extractionRegex = /["']?serializedError["']?:[ ]?(?:`(.+?)`|'(.+?)'|"((?:\\"|[^"])*?)")/;
        const serialized = _stderr.match(extractionRegex);
        if (serialized && serialized.length === 4) {
            // 4 because 1 match and 3 capturing groups
            try {
                const serializedString = serialized
                    .slice(1)
                    .find((item) => item && item.length > 0)
                    ?.replaceAll('\\"', '"')
                    .replaceAll("\\'", "'");
                if (!serializedString) {
                    return undefined;
                }
                const { name, classification, options, cause } = JSON.parse(serializedString);
                let serializedCause = cause;
                if (cause && ErrorSerializerDeserializer.isSerializedErrorType(cause)) {
                    serializedCause = ErrorSerializerDeserializer.deserialize(cause);
                }
                return classification === 'ERROR'
                    ? new _1.AmplifyUserError(name, options, serializedCause)
                    : new _1.AmplifyFault(name, options, serializedCause);
            }
            catch (error) {
                // cannot deserialize
                return undefined;
            }
        }
        return undefined;
    };
    static fromError = (error) => {
        const errorMessage = error instanceof Error
            ? `${error.name}: ${error.message}`
            : 'An unknown error happened. Check downstream error';
        return new _1.AmplifyFault('UnknownFault', {
            message: errorMessage,
        }, error instanceof Error ? error : new Error(String(error)));
    };
}
exports.AmplifyError = AmplifyError;
const errorSerializer = (_, value) => {
    if (value instanceof Error) {
        return ErrorSerializerDeserializer.serialize(value);
    }
    return value;
};
class ErrorSerializerDeserializer {
    static serialize = (error) => {
        const serializedError = {
            name: error.name,
            message: error.message,
        };
        return serializedError;
    };
    static deserialize = (deserialized) => {
        const error = new Error(deserialized.message);
        error.name = deserialized.name;
        return error;
    };
    static isSerializedErrorType = (obj) => {
        if (obj &&
            obj.name &&
            obj.message)
            return true;
        return false;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW1wbGlmeV9lcnJvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lcnJvcnMvYW1wbGlmeV9lcnJvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx3QkFBbUQ7QUFFbkQ7O0dBRUc7QUFDSCxNQUFzQixZQUF3QyxTQUFRLEtBQUs7SUF1QnZEO0lBQ0E7SUFDQztJQUNEO0lBekJYLGVBQWUsQ0FBVTtJQUNoQixPQUFPLENBQVM7SUFDaEIsVUFBVSxDQUFVO0lBQ3BCLE9BQU8sQ0FBVTtJQUNqQixJQUFJLENBQVU7SUFDZCxJQUFJLENBQVU7SUFFOUI7Ozs7Ozs7Ozs7Ozs7T0FhRztJQUNILFlBQ2tCLElBQU8sRUFDUCxjQUEwQyxFQUN6QyxPQUE0QixFQUM3QixLQUFhO1FBRTdCLDZFQUE2RTtRQUM3RSw2RUFBNkU7UUFDN0UsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBUGxCLFNBQUksR0FBSixJQUFJLENBQUc7UUFDUCxtQkFBYyxHQUFkLGNBQWMsQ0FBNEI7UUFDekMsWUFBTyxHQUFQLE9BQU8sQ0FBcUI7UUFDN0IsVUFBSyxHQUFMLEtBQUssQ0FBUTtRQU03Qiw2SUFBNkk7UUFDN0ksTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRXBELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztRQUMvQixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7UUFDL0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUN6QixJQUFJLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFFekIsSUFBSSxLQUFLLElBQUksS0FBSyxZQUFZLFlB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QyxNQUFNLGVBQWUsR0FBd0I7WUFDM0MsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO1lBQ2hCLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztTQUN2QixDQUFDO1FBQ0YsT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQyxDQUFDO0lBRUYsTUFBTSxDQUFDLFdBQVcsR0FBRyxDQUFDLFlBQWlDLEVBQUUsRUFBRTtRQUN6RCxNQUFNLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUMsS0FBSyxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDO1FBQy9CLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQyxDQUFDO0lBRUYsTUFBTSxDQUFDLHFCQUFxQixHQUFHLENBQUMsR0FBWSxFQUE4QixFQUFFO1FBQzFFLElBQ0UsR0FBRztZQUNGLEdBQTJCLENBQUMsSUFBSTtZQUNoQyxHQUEyQixDQUFDLE9BQU87WUFFcEMsT0FBTyxJQUFJLENBQUM7UUFDZCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFtcGxpZnlGYXVsdCwgQW1wbGlmeVVzZXJFcnJvciB9IGZyb20gJy4nO1xuXG4vKipcbiAqIEJhc2UgY2xhc3MgZm9yIGFsbCBBbXBsaWZ5IGVycm9ycyBvciBmYXVsdHNcbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFtcGxpZnlFcnJvcjxUIGV4dGVuZHMgc3RyaW5nID0gc3RyaW5nPiBleHRlbmRzIEVycm9yIHtcbiAgcHVibGljIHNlcmlhbGl6ZWRFcnJvcj86IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IG1lc3NhZ2U6IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IHJlc29sdXRpb24/OiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBkZXRhaWxzPzogc3RyaW5nO1xuICBwdWJsaWMgcmVhZG9ubHkgbGluaz86IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IGNvZGU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFlvdSBzaG91bGQgdXNlIEFtcGxpZnlVc2VyRXJyb3Igb3IgQW1wbGlmeUxpYnJhcnlGYXVsdCB0byB0aHJvdyBhbiBlcnJvci5cbiAgICogQHBhcmFtIG5hbWUgLSBhIHVzZXIgZnJpZW5kbHkgbmFtZSBmb3IgdGhlIGV4Y2VwdGlvblxuICAgKiBAcGFyYW0gY2xhc3NpZmljYXRpb24gLSBMaWJyYXJ5RmF1bHQgb3IgVXNlckVycm9yXG4gICAqIEBwYXJhbSBvcHRpb25zIC0gZXJyb3Igc3RhY2ssIHJlc29sdXRpb24gc3RlcHMsIGRldGFpbHMsIG9yIGhlbHAgbGlua3NcbiAgICogQHBhcmFtIGNhdXNlIElmIHlvdSBhcmUgdGhyb3dpbmcgdGhpcyBleGNlcHRpb24gZnJvbSB3aXRoaW4gYSBjYXRjaCBibG9jayxcbiAgICogeW91IG11c3QgcHJvdmlkZSB0aGUgZXhjZXB0aW9uIHRoYXQgd2FzIGNhdWdodC5cbiAgICogQGV4YW1wbGVcbiAgICogdHJ5IHtcbiAgICogIC4uLlxuICAgKiB9IGNhdGNoIChlcnJvcil7XG4gICAqICAgIHRocm93IG5ldyBBbXBsaWZ5RXJyb3IoLi4uLC4uLixlcnJvcik7XG4gICAqIH1cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZWFkb25seSBuYW1lOiBULFxuICAgIHB1YmxpYyByZWFkb25seSBjbGFzc2lmaWNhdGlvbjogQW1wbGlmeUVycm9yQ2xhc3NpZmljYXRpb24sXG4gICAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBBbXBsaWZ5RXJyb3JPcHRpb25zLFxuICAgIHB1YmxpYyByZWFkb25seSBjYXVzZT86IEVycm9yXG4gICkge1xuICAgIC8vIElmIGFuIEFtcGxpZnlFcnJvciB3YXMgYWxyZWFkeSB0aHJvd24sIHdlIG11c3QgYWxsb3cgaXQgdG8gcmVhY2ggdGhlIHVzZXIuXG4gICAgLy8gVGhpcyBlbnN1cmVzIHRoYXQgcmVzb2x1dGlvbiBzdGVwcywgYW5kIHRoZSBvcmlnaW5hbCBlcnJvciBhcmUgYnViYmxlZCB1cC5cbiAgICBzdXBlcihvcHRpb25zLm1lc3NhZ2UsIHsgY2F1c2UgfSk7XG5cbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQtd2lraS9ibG9iL21haW4vQnJlYWtpbmctQ2hhbmdlcy5tZCNleHRlbmRpbmctYnVpbHQtaW5zLWxpa2UtZXJyb3ItYXJyYXktYW5kLW1hcC1tYXktbm8tbG9uZ2VyLXdvcmtcbiAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgQW1wbGlmeUVycm9yLnByb3RvdHlwZSk7XG5cbiAgICB0aGlzLm1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2U7XG4gICAgdGhpcy5kZXRhaWxzID0gb3B0aW9ucy5kZXRhaWxzO1xuICAgIHRoaXMucmVzb2x1dGlvbiA9IG9wdGlvbnMucmVzb2x1dGlvbjtcbiAgICB0aGlzLmNvZGUgPSBvcHRpb25zLmNvZGU7XG4gICAgdGhpcy5saW5rID0gb3B0aW9ucy5saW5rO1xuXG4gICAgaWYgKGNhdXNlICYmIGNhdXNlIGluc3RhbmNlb2YgQW1wbGlmeUVycm9yKSB7XG4gICAgICBjYXVzZS5zZXJpYWxpemVkRXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHRoaXMuc2VyaWFsaXplZEVycm9yID0gSlNPTi5zdHJpbmdpZnkoXG4gICAgICB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGNsYXNzaWZpY2F0aW9uLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBjYXVzZSxcbiAgICAgIH0sXG4gICAgICBlcnJvclNlcmlhbGl6ZXJcbiAgICApO1xuICB9XG5cbiAgc3RhdGljIGZyb21TdGRlcnIgPSAoX3N0ZGVycjogc3RyaW5nKTogQW1wbGlmeUVycm9yIHwgdW5kZWZpbmVkID0+IHtcbiAgICAvKipcbiAgICAgKiBgW1wiJ10/c2VyaWFsaXplZEVycm9yW1wiJ10/OlsgXT9gIGNhcHR1cmVzIHRoZSBzdGFydCBvZiB0aGUgc2VyaWFsaXplZCBlcnJvci4gVGhlIHF1b3RlcyBkZXBlbmQgb24gd2hpY2ggT1MgaXMgYmVpbmcgdXNlZFxuICAgICAqIGAoPzpgKC4rPylgfCcoLis/KSd8XCIoKD86XFxcXFwifFteXCJdKSo/KVwiKWAgY2FwdHVyZXMgdGhlIHJlc3Qgb2YgdGhlIHNlcmlhbGl6ZWQgc3RyaW5nIGVuY2xvc2VkIGluIGVpdGhlciBzaW5nbGUgcXVvdGUsXG4gICAgICogZG91YmxlIHF1b3RlcyBvciBiYWNrLXRpY2tzLlxuICAgICAqL1xuICAgIGNvbnN0IGV4dHJhY3Rpb25SZWdleCA9XG4gICAgICAvW1wiJ10/c2VyaWFsaXplZEVycm9yW1wiJ10/OlsgXT8oPzpgKC4rPylgfCcoLis/KSd8XCIoKD86XFxcXFwifFteXCJdKSo/KVwiKS87XG4gICAgY29uc3Qgc2VyaWFsaXplZCA9IF9zdGRlcnIubWF0Y2goZXh0cmFjdGlvblJlZ2V4KTtcbiAgICBpZiAoc2VyaWFsaXplZCAmJiBzZXJpYWxpemVkLmxlbmd0aCA9PT0gNCkge1xuICAgICAgLy8gNCBiZWNhdXNlIDEgbWF0Y2ggYW5kIDMgY2FwdHVyaW5nIGdyb3Vwc1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZFN0cmluZyA9IHNlcmlhbGl6ZWRcbiAgICAgICAgICAuc2xpY2UoMSlcbiAgICAgICAgICAuZmluZCgoaXRlbSkgPT4gaXRlbSAmJiBpdGVtLmxlbmd0aCA+IDApXG4gICAgICAgICAgPy5yZXBsYWNlQWxsKCdcXFxcXCInLCAnXCInKVxuICAgICAgICAgIC5yZXBsYWNlQWxsKFwiXFxcXCdcIiwgXCInXCIpO1xuXG4gICAgICAgIGlmICghc2VyaWFsaXplZFN0cmluZykge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IG5hbWUsIGNsYXNzaWZpY2F0aW9uLCBvcHRpb25zLCBjYXVzZSB9ID1cbiAgICAgICAgICBKU09OLnBhcnNlKHNlcmlhbGl6ZWRTdHJpbmcpO1xuXG4gICAgICAgIGxldCBzZXJpYWxpemVkQ2F1c2UgPSBjYXVzZTtcbiAgICAgICAgaWYgKGNhdXNlICYmIEVycm9yU2VyaWFsaXplckRlc2VyaWFsaXplci5pc1NlcmlhbGl6ZWRFcnJvclR5cGUoY2F1c2UpKSB7XG4gICAgICAgICAgc2VyaWFsaXplZENhdXNlID0gRXJyb3JTZXJpYWxpemVyRGVzZXJpYWxpemVyLmRlc2VyaWFsaXplKGNhdXNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2xhc3NpZmljYXRpb24gPT09ICdFUlJPUidcbiAgICAgICAgICA/IG5ldyBBbXBsaWZ5VXNlckVycm9yKG5hbWUsIG9wdGlvbnMsIHNlcmlhbGl6ZWRDYXVzZSlcbiAgICAgICAgICA6IG5ldyBBbXBsaWZ5RmF1bHQobmFtZSwgb3B0aW9ucywgc2VyaWFsaXplZENhdXNlKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIGNhbm5vdCBkZXNlcmlhbGl6ZVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIHN0YXRpYyBmcm9tRXJyb3IgPSAoZXJyb3I6IHVua25vd24pOiBBbXBsaWZ5RXJyb3I8J1Vua25vd25GYXVsdCc+ID0+IHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICA/IGAke2Vycm9yLm5hbWV9OiAke2Vycm9yLm1lc3NhZ2V9YFxuICAgICAgICA6ICdBbiB1bmtub3duIGVycm9yIGhhcHBlbmVkLiBDaGVjayBkb3duc3RyZWFtIGVycm9yJztcblxuICAgIHJldHVybiBuZXcgQW1wbGlmeUZhdWx0KFxuICAgICAgJ1Vua25vd25GYXVsdCcsXG4gICAgICB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yTWVzc2FnZSxcbiAgICAgIH0sXG4gICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSlcbiAgICApO1xuICB9O1xufVxuXG4vKipcbiAqIEFtcGxpZnkgZXhjZXB0aW9uIGNsYXNzaWZpY2F0aW9uc1xuICovXG5leHBvcnQgdHlwZSBBbXBsaWZ5RXJyb3JDbGFzc2lmaWNhdGlvbiA9ICdGQVVMVCcgfCAnRVJST1InO1xuXG4vKipcbiAqIEFtcGxpZnkgRXJyb3Igb3B0aW9ucyBvYmplY3RcbiAqL1xuZXhwb3J0IHR5cGUgQW1wbGlmeUVycm9yT3B0aW9ucyA9IHtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBkZXRhaWxzPzogc3RyaW5nO1xuICByZXNvbHV0aW9uPzogc3RyaW5nO1xuICBsaW5rPzogc3RyaW5nO1xuXG4gIC8vIENsb3VkRm9ybWF0aW9uIG9yIE5vZGVKUyBlcnJvciBjb2Rlc1xuICBjb2RlPzogc3RyaW5nO1xufTtcblxuLyoqXG4gKiBTYW1lIGFzIEFtcGxpZnlFcnJvck9wdGlvbnMgZXhjZXB0IHJlc29sdXRpb24gaXMgcmVxdWlyZWRcbiAqL1xuZXhwb3J0IHR5cGUgQW1wbGlmeVVzZXJFcnJvck9wdGlvbnMgPSBPbWl0PFxuICBBbXBsaWZ5RXJyb3JPcHRpb25zLFxuICAncmVzb2x1dGlvbidcbj4gJiB7IHJlc29sdXRpb246IHN0cmluZyB9O1xuXG5jb25zdCBlcnJvclNlcmlhbGl6ZXIgPSAoXzogdW5rbm93biwgdmFsdWU6IHVua25vd24pID0+IHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICByZXR1cm4gRXJyb3JTZXJpYWxpemVyRGVzZXJpYWxpemVyLnNlcmlhbGl6ZSh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufTtcbmNsYXNzIEVycm9yU2VyaWFsaXplckRlc2VyaWFsaXplciB7XG4gIHN0YXRpYyBzZXJpYWxpemUgPSAoZXJyb3I6IEVycm9yKSA9PiB7XG4gICAgY29uc3Qgc2VyaWFsaXplZEVycm9yOiBTZXJpYWxpemVkRXJyb3JUeXBlID0ge1xuICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgfTtcbiAgICByZXR1cm4gc2VyaWFsaXplZEVycm9yO1xuICB9O1xuXG4gIHN0YXRpYyBkZXNlcmlhbGl6ZSA9IChkZXNlcmlhbGl6ZWQ6IFNlcmlhbGl6ZWRFcnJvclR5cGUpID0+IHtcbiAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihkZXNlcmlhbGl6ZWQubWVzc2FnZSk7XG4gICAgZXJyb3IubmFtZSA9IGRlc2VyaWFsaXplZC5uYW1lO1xuICAgIHJldHVybiBlcnJvcjtcbiAgfTtcblxuICBzdGF0aWMgaXNTZXJpYWxpemVkRXJyb3JUeXBlID0gKG9iajogdW5rbm93bik6IG9iaiBpcyBTZXJpYWxpemVkRXJyb3JUeXBlID0+IHtcbiAgICBpZiAoXG4gICAgICBvYmogJiZcbiAgICAgIChvYmogYXMgU2VyaWFsaXplZEVycm9yVHlwZSkubmFtZSAmJlxuICAgICAgKG9iaiBhcyBTZXJpYWxpemVkRXJyb3JUeXBlKS5tZXNzYWdlXG4gICAgKVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xufVxudHlwZSBTZXJpYWxpemVkRXJyb3JUeXBlID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIG1lc3NhZ2U6IHN0cmluZztcbn07XG4iXX0=