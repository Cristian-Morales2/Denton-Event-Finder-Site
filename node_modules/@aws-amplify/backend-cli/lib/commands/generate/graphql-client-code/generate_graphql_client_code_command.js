import { isAbsolute, resolve } from 'path';
import { GenerateApiCodeFormat, GenerateApiCodeModelTarget, GenerateApiCodeStatementTarget, GenerateApiCodeTypeTarget, } from '@aws-amplify/model-generator';
const DEFAULT_TYPE_TARGET_FOR_STATEMENT_TARGET = {
    [GenerateApiCodeStatementTarget.JAVASCRIPT]: undefined,
    [GenerateApiCodeStatementTarget.TYPESCRIPT]: GenerateApiCodeTypeTarget.TYPESCRIPT,
    [GenerateApiCodeStatementTarget.GRAPHQL]: undefined,
    [GenerateApiCodeStatementTarget.FLOW]: GenerateApiCodeTypeTarget.FLOW,
    [GenerateApiCodeStatementTarget.ANGULAR]: GenerateApiCodeTypeTarget.ANGULAR,
};
/**
 * Command that generates graphql client code.
 */
export class GenerateGraphqlClientCodeCommand {
    generateApiCodeAdapter;
    backendIdentifierResolver;
    /**
     * @inheritDoc
     */
    command;
    /**
     * @inheritDoc
     */
    describe;
    /**
     * Creates graphql client code generation command.
     */
    constructor(generateApiCodeAdapter, backendIdentifierResolver) {
        this.generateApiCodeAdapter = generateApiCodeAdapter;
        this.backendIdentifierResolver = backendIdentifierResolver;
        this.command = 'graphql-client-code';
        this.describe = 'Generates graphql API code';
    }
    /**
     * @inheritDoc
     */
    handler = async (args) => {
        const backendIdentifier = await this.backendIdentifierResolver.resolve(args);
        const out = this.getOutDir(args);
        const format = args.format ?? GenerateApiCodeFormat.GRAPHQL_CODEGEN;
        const formatParams = this.formatParamBuilders[format](args);
        const result = await this.generateApiCodeAdapter.invokeGenerateApiCode({
            ...backendIdentifier,
            ...formatParams,
        });
        await result.writeToDirectory(out);
    };
    /**
     * @inheritDoc
     */
    builder = (yargs) => {
        return yargs
            .option('stack', {
            conflicts: ['app-id', 'branch'],
            describe: 'A stack name that contains an Amplify backend',
            type: 'string',
            array: false,
            group: 'Stack identifier',
        })
            .option('app-id', {
            conflicts: ['stack'],
            describe: 'The Amplify App ID of the project',
            type: 'string',
            array: false,
            implies: 'branch',
            group: 'Project identifier',
        })
            .option('branch', {
            conflicts: ['stack'],
            describe: 'A git branch of the Amplify project',
            type: 'string',
            array: false,
            group: 'Project identifier',
        })
            .option('out', {
            describe: 'A path to directory where config is written. If not provided defaults to current process working directory.',
            type: 'string',
            array: false,
        })
            .option('format', {
            describe: 'The format that the GraphQL client code should be generated in.',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeFormat),
        })
            .option('model-target', {
            describe: 'The modelgen export target. Only applies when the `--format` parameter is set to `modelgen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeModelTarget),
        })
            .option('statement-target', {
            describe: 'The graphql-codegen statement export target. Only applies when the `--format` parameter is set to `graphql-codegen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeStatementTarget),
        })
            .option('type-target', {
            describe: 'The optional graphql-codegen type export target. Only applies when the `--format` parameter is set to `graphql-codegen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeTypeTarget),
        })
            .option('model-generate-index-rules', {
            description: 'Adds key/index details to iOS models',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-emit-auth-provider', {
            description: 'Adds auth provider details to iOS models',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-respect-primary-key-attributes-on-connection-field', {
            description: 'If enabled, Datastore queries will respect the primary + sort key fields, rather than a default id field',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-generate-models-for-lazy-load-and-custom-selection-set', {
            description: 'Generates lazy model type definitions, required or amplify-js v5+',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-add-timestamp-fields', {
            description: 'Add read-only timestamp fields in modelgen.',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('model-handle-list-nullability-transparently', {
            description: 'Configure the nullability of the List and List components in Datastore Models generation',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('statement-max-depth', {
            description: 'Determines how deeply nested to generate graphql statements.',
            type: 'number',
            array: false,
            hidden: true,
        })
            .option('statement-typename-introspection', {
            description: 'Determines whether to include default __typename for all generated statements',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .option('type-multiple-swift-files', {
            description: 'Determines whether or not to generate a single API.swift, or multiple per-model swift files.',
            type: 'boolean',
            array: false,
            hidden: true,
        })
            .showHidden('all');
    };
    /**
     * Produce the required input for graphql-codegen calls from the CLI input, applying sane defaults where applicable.
     * @param args CLI args provided by the customer
     * @returns the codegen options config
     */
    getGraphqlCodegenFormatParams = (args) => {
        const statementTarget = args['statement-target'] ?? GenerateApiCodeStatementTarget.TYPESCRIPT;
        const typeTarget = args['type-target'] ??
            DEFAULT_TYPE_TARGET_FOR_STATEMENT_TARGET[statementTarget];
        const maxDepth = args['statement-max-depth'];
        const typeNameIntrospection = args['statement-typename-introspection'];
        const multipleSwiftFiles = args['type-multiple-swift-files'];
        return {
            format: GenerateApiCodeFormat.GRAPHQL_CODEGEN,
            statementTarget,
            ...(typeTarget !== undefined ? { typeTarget } : {}),
            ...(maxDepth !== undefined ? { maxDepth } : {}),
            ...(typeNameIntrospection !== undefined ? { typeNameIntrospection } : {}),
            ...(multipleSwiftFiles !== undefined ? { multipleSwiftFiles } : {}),
        };
    };
    /**
     * Produce the required input for modelgen calls from the CLI input, applying sane defaults where applicable.
     * @param args CLI args provided by the customer
     * @returns the modelgen options config
     */
    getModelgenFormatParams = (args) => {
        const modelTarget = args['model-target'] ?? GenerateApiCodeModelTarget.TYPESCRIPT;
        const generateIndexRules = args['model-generate-index-rules'];
        const emitAuthProvider = args['model-emit-auth-provider'];
        const respectPrimaryKeyAttributesOnConnectionField = args['model-respect-primary-key-attributes-on-connection-field'];
        const generateModelsForLazyLoadAndCustomSelectionSet = args['model-generate-models-for-lazy-load-and-custom-selection-set'];
        const addTimestampFields = args['model-add-timestamp-fields'];
        const handleListNullabilityTransparently = args['model-handle-list-nullability-transparently'];
        return {
            format: GenerateApiCodeFormat.MODELGEN,
            modelTarget,
            ...(generateIndexRules !== undefined ? { generateIndexRules } : {}),
            ...(emitAuthProvider !== undefined ? { emitAuthProvider } : {}),
            ...(respectPrimaryKeyAttributesOnConnectionField !== undefined
                ? { respectPrimaryKeyAttributesOnConnectionField }
                : {}),
            ...(generateModelsForLazyLoadAndCustomSelectionSet !== undefined
                ? { generateModelsForLazyLoadAndCustomSelectionSet }
                : {}),
            ...(addTimestampFields !== undefined ? { addTimestampFields } : {}),
            ...(handleListNullabilityTransparently !== undefined
                ? { handleListNullabilityTransparently }
                : {}),
        };
    };
    /**
     * Produce the introspection schema config shape.
     * @returns the introspection options config
     */
    getIntrospectionFormatParams = () => ({
        format: GenerateApiCodeFormat.INTROSPECTION,
    });
    getOutDir = (args) => {
        const cwd = process.cwd();
        if (!args.out) {
            return cwd;
        }
        return isAbsolute(args.out) ? args.out : resolve(cwd, args.out);
    };
    // This property references other methods in the class so it must be defined at the end.
    // This is probably an indicator that some refactoring should happen here but right now I'm just trying to apply this lint rule to the codebase
    // eslint-disable-next-line @typescript-eslint/member-ordering
    formatParamBuilders = {
        [GenerateApiCodeFormat.MODELGEN]: this.getModelgenFormatParams,
        [GenerateApiCodeFormat.GRAPHQL_CODEGEN]: this.getGraphqlCodegenFormatParams,
        [GenerateApiCodeFormat.INTROSPECTION]: this.getIntrospectionFormatParams,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVfZ3JhcGhxbF9jbGllbnRfY29kZV9jb21tYW5kLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbW1hbmRzL2dlbmVyYXRlL2dyYXBocWwtY2xpZW50LWNvZGUvZ2VuZXJhdGVfZ3JhcGhxbF9jbGllbnRfY29kZV9jb21tYW5kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBSzNDLE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsMEJBQTBCLEVBQzFCLDhCQUE4QixFQUM5Qix5QkFBeUIsR0FJMUIsTUFBTSw4QkFBOEIsQ0FBQztBQStCdEMsTUFBTSx3Q0FBd0MsR0FHMUM7SUFDRixDQUFDLDhCQUE4QixDQUFDLFVBQVUsQ0FBQyxFQUFFLFNBQVM7SUFDdEQsQ0FBQyw4QkFBOEIsQ0FBQyxVQUFVLENBQUMsRUFDekMseUJBQXlCLENBQUMsVUFBVTtJQUN0QyxDQUFDLDhCQUE4QixDQUFDLE9BQU8sQ0FBQyxFQUFFLFNBQVM7SUFDbkQsQ0FBQyw4QkFBOEIsQ0FBQyxJQUFJLENBQUMsRUFBRSx5QkFBeUIsQ0FBQyxJQUFJO0lBQ3JFLENBQUMsOEJBQThCLENBQUMsT0FBTyxDQUFDLEVBQUUseUJBQXlCLENBQUMsT0FBTztDQUM1RSxDQUFDO0FBRUY7O0dBRUc7QUFDSCxNQUFNLE9BQU8sZ0NBQWdDO0lBaUJ4QjtJQUNBO0lBZm5COztPQUVHO0lBQ00sT0FBTyxDQUFTO0lBRXpCOztPQUVHO0lBQ00sUUFBUSxDQUFTO0lBRTFCOztPQUVHO0lBQ0gsWUFDbUIsc0JBQThDLEVBQzlDLHlCQUFvRDtRQURwRCwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBQzlDLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUFFckUsSUFBSSxDQUFDLE9BQU8sR0FBRyxxQkFBcUIsQ0FBQztRQUNyQyxJQUFJLENBQUMsUUFBUSxHQUFH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IEFyZ3YsIENvbW1hbmRNb2R1bGUgfSBmcm9tICd5YXJncyc7XG5pbXBvcnQgeyBCYWNrZW5kSWRlbnRpZmllclJlc29sdmVyIH0gZnJvbSAnLi4vLi4vLi4vYmFja2VuZC1pZGVudGlmaWVyL2JhY2tlbmRfaWRlbnRpZmllcl9yZXNvbHZlci5qcyc7XG5pbXBvcnQgeyBpc0Fic29sdXRlLCByZXNvbHZlIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQge1xuICBHZW5lcmF0ZUFwaUNvZGVBZGFwdGVyLFxuICBJbnZva2VHZW5lcmF0ZUFwaUNvZGVQcm9wcyxcbn0gZnJvbSAnLi9nZW5lcmF0ZV9hcGlfY29kZV9hZGFwdGVyLmpzJztcbmltcG9ydCB7XG4gIEdlbmVyYXRlQXBpQ29kZUZvcm1hdCxcbiAgR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQsXG4gIEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldCxcbiAgR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldCxcbiAgR2VuZXJhdGVHcmFwaHFsQ29kZWdlbk9wdGlvbnMsXG4gIEdlbmVyYXRlSW50cm9zcGVjdGlvbk9wdGlvbnMsXG4gIEdlbmVyYXRlTW9kZWxzT3B0aW9ucyxcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L21vZGVsLWdlbmVyYXRvcic7XG5pbXBvcnQgeyBBcmd1bWVudHNLZWJhYkNhc2UgfSBmcm9tICcuLi8uLi8uLi9rZWJhYl9jYXNlLmpzJztcblxudHlwZSBHZW5lcmF0ZU9wdGlvbnMgPVxuICB8IEdlbmVyYXRlR3JhcGhxbENvZGVnZW5PcHRpb25zXG4gIHwgR2VuZXJhdGVNb2RlbHNPcHRpb25zXG4gIHwgR2VuZXJhdGVJbnRyb3NwZWN0aW9uT3B0aW9ucztcblxuZXhwb3J0IHR5cGUgR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zID1cbiAgQXJndW1lbnRzS2ViYWJDYXNlPEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9uc0NhbWVsQ2FzZT47XG5cbnR5cGUgR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zQ2FtZWxDYXNlID0ge1xuICBzdGFjazogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBhcHBJZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBicmFuY2g6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgZm9ybWF0OiBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQgfCB1bmRlZmluZWQ7XG4gIG1vZGVsVGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVNb2RlbFRhcmdldCB8IHVuZGVmaW5lZDtcbiAgc3RhdGVtZW50VGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQgfCB1bmRlZmluZWQ7XG4gIHR5cGVUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQgfCB1bmRlZmluZWQ7XG4gIG91dDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBtb2RlbEdlbmVyYXRlSW5kZXhSdWxlczogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgbW9kZWxFbWl0QXV0aFByb3ZpZGVyOiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICBtb2RlbFJlc3BlY3RQcmltYXJ5S2V5QXR0cmlidXRlc09uQ29ubmVjdGlvbkZpZWxkOiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICBtb2RlbEdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQ6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIG1vZGVsQWRkVGltZXN0YW1wRmllbGRzOiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICBtb2RlbEhhbmRsZUxpc3ROdWxsYWJpbGl0eVRyYW5zcGFyZW50bHk6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIHN0YXRlbWVudE1heERlcHRoOiBudW1iZXIgfCB1bmRlZmluZWQ7XG4gIHN0YXRlbWVudFR5cGVuYW1lSW50cm9zcGVjdGlvbjogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgdHlwZU11bHRpcGxlU3dpZnRGaWxlczogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbn07XG5cbmNvbnN0IERFRkFVTFRfVFlQRV9UQVJHRVRfRk9SX1NUQVRFTUVOVF9UQVJHRVQ6IFJlY29yZDxcbiAgR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LFxuICBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0IHwgdW5kZWZpbmVkXG4+ID0ge1xuICBbR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LkpBVkFTQ1JJUFRdOiB1bmRlZmluZWQsXG4gIFtHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQuVFlQRVNDUklQVF06XG4gICAgR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldC5UWVBFU0NSSVBULFxuICBbR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LkdSQVBIUUxdOiB1bmRlZmluZWQsXG4gIFtHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQuRkxPV106IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQuRkxPVyxcbiAgW0dlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5BTkdVTEFSXTogR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldC5BTkdVTEFSLFxufTtcblxuLyoqXG4gKiBDb21tYW5kIHRoYXQgZ2VuZXJhdGVzIGdyYXBocWwgY2xpZW50IGNvZGUuXG4gKi9cbmV4cG9ydCBjbGFzcyBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZFxuICBpbXBsZW1lbnRzIENvbW1hbmRNb2R1bGU8b2JqZWN0LCBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnM+XG57XG4gIC8qKlxuICAgKiBAaW5oZXJpdERvY1xuICAgKi9cbiAgcmVhZG9ubHkgY29tbWFuZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAaW5oZXJpdERvY1xuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpYmU6IHN0cmluZztcblxuICAvKipcbiAgICogQ3JlYXRlcyBncmFwaHFsIGNsaWVudCBjb2RlIGdlbmVyYXRpb24gY29tbWFuZC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZ2VuZXJhdGVBcGlDb2RlQWRhcHRlcjogR2VuZXJhdGVBcGlDb2RlQWRhcHRlcixcbiAgICBwcml2YXRlIHJlYWRvbmx5IGJhY2tlbmRJZGVudGlmaWVyUmVzb2x2ZXI6IEJhY2tlbmRJZGVudGlmaWVyUmVzb2x2ZXJcbiAgKSB7XG4gICAgdGhpcy5jb21tYW5kID0gJ2dyYXBocWwtY2xpZW50LWNvZGUnO1xuICAgIHRoaXMuZGVzY3JpYmUgPSAnR2VuZXJhdGVzIGdyYXBocWwgQVBJIGNvZGUnO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0RG9jXG4gICAqL1xuICBoYW5kbGVyID0gYXN5bmMgKFxuICAgIGFyZ3M6IEFyZ3VtZW50c0NhbWVsQ2FzZTxHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnM+XG4gICk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIGNvbnN0IGJhY2tlbmRJZGVudGlmaWVyID0gYXdhaXQgdGhpcy5iYWNrZW5kSWRlbnRpZmllclJlc29sdmVyLnJlc29sdmUoXG4gICAgICBhcmdzXG4gICAgKTtcbiAgICBjb25zdCBvdXQgPSB0aGlzLmdldE91dERpcihhcmdzKTtcbiAgICBjb25zdCBmb3JtYXQgPSBhcmdzLmZvcm1hdCA/PyBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuR1JBUEhRTF9DT0RFR0VOO1xuICAgIGNvbnN0IGZvcm1hdFBhcmFtcyA9IHRoaXMuZm9ybWF0UGFyYW1CdWlsZGVyc1tmb3JtYXRdKGFyZ3MpO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUFwaUNvZGVBZGFwdGVyLmludm9rZUdlbmVyYXRlQXBpQ29kZSh7XG4gICAgICAuLi5iYWNrZW5kSWRlbnRpZmllcixcbiAgICAgIC4uLmZvcm1hdFBhcmFtcyxcbiAgICB9IGFzIHVua25vd24gYXMgSW52b2tlR2VuZXJhdGVBcGlDb2RlUHJvcHMpO1xuXG4gICAgYXdhaXQgcmVzdWx0LndyaXRlVG9EaXJlY3Rvcnkob3V0KTtcbiAgfTtcblxuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIGJ1aWxkZXIgPSAoeWFyZ3M6IEFyZ3YpOiBBcmd2PEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9ucz4gPT4ge1xuICAgIHJldHVybiB5YXJnc1xuICAgICAgLm9wdGlvbignc3RhY2snLCB7XG4gICAgICAgIGNvbmZsaWN0czogWydhcHAtaWQnLCAnYnJhbmNoJ10sXG4gICAgICAgIGRlc2NyaWJlOiAnQSBzdGFjayBuYW1lIHRoYXQgY29udGFpbnMgYW4gQW1wbGlmeSBiYWNrZW5kJyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgZ3JvdXA6ICdTdGFjayBpZGVudGlmaWVyJyxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdhcHAtaWQnLCB7XG4gICAgICAgIGNvbmZsaWN0czogWydzdGFjayddLFxuICAgICAgICBkZXNjcmliZTogJ1RoZSBBbXBsaWZ5IEFwcCBJRCBvZiB0aGUgcHJvamVjdCcsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGltcGxpZXM6ICdicmFuY2gnLFxuICAgICAgICBncm91cDogJ1Byb2plY3QgaWRlbnRpZmllcicsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignYnJhbmNoJywge1xuICAgICAgICBjb25mbGljdHM6IFsnc3RhY2snXSxcbiAgICAgICAgZGVzY3JpYmU6ICdBIGdpdCBicmFuY2ggb2YgdGhlIEFtcGxpZnkgcHJvamVjdCcsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGdyb3VwOiAnUHJvamVjdCBpZGVudGlmaWVyJyxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdvdXQnLCB7XG4gICAgICAgIGRlc2NyaWJlOlxuICAgICAgICAgICdBIHBhdGggdG8gZGlyZWN0b3J5IHdoZXJlIGNvbmZpZyBpcyB3cml0dGVuLiBJZiBub3QgcHJvdmlkZWQgZGVmYXVsdHMgdG8gY3VycmVudCBwcm9jZXNzIHdvcmtpbmcgZGlyZWN0b3J5LicsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignZm9ybWF0Jywge1xuICAgICAgICBkZXNjcmliZTpcbiAgICAgICAgICAnVGhlIGZvcm1hdCB0aGF0IHRoZSBHcmFwaFFMIGNsaWVudCBjb2RlIHNob3VsZCBiZSBnZW5lcmF0ZWQgaW4uJyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgY2hvaWNlczogT2JqZWN0LnZhbHVlcyhHZW5lcmF0ZUFwaUNvZGVGb3JtYXQpLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ21vZGVsLXRhcmdldCcsIHtcbiAgICAgICAgZGVzY3JpYmU6XG4gICAgICAgICAgJ1RoZSBtb2RlbGdlbiBleHBvcnQgdGFyZ2V0LiBPbmx5IGFwcGxpZXMgd2hlbiB0aGUgYC0tZm9ybWF0YCBwYXJhbWV0ZXIgaXMgc2V0IHRvIGBtb2RlbGdlbmAnLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBjaG9pY2VzOiBPYmplY3QudmFsdWVzKEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0KSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdzdGF0ZW1lbnQtdGFyZ2V0Jywge1xuICAgICAgICBkZXNjcmliZTpcbiAgICAgICAgICAnVGhlIGdyYXBocWwtY29kZWdlbiBzdGF0ZW1lbnQgZXhwb3J0IHRhcmdldC4gT25seSBhcHBsaWVzIHdoZW4gdGhlIGAtLWZvcm1hdGAgcGFyYW1ldGVyIGlzIHNldCB0byBgZ3JhcGhxbC1jb2RlZ2VuYCcsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGNob2ljZXM6IE9iamVjdC52YWx1ZXMoR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0KSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCd0eXBlLXRhcmdldCcsIHtcbiAgICAgICAgZGVzY3JpYmU6XG4gICAgICAgICAgJ1RoZSBvcHRpb25hbCBncmFwaHFsLWNvZGVnZW4gdHlwZSBleHBvcnQgdGFyZ2V0LiBPbmx5IGFwcGxpZXMgd2hlbiB0aGUgYC0tZm9ybWF0YCBwYXJhbWV0ZXIgaXMgc2V0IHRvIGBncmFwaHFsLWNvZGVnZW5gJyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgY2hvaWNlczogT2JqZWN0LnZhbHVlcyhHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0KSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1nZW5lcmF0ZS1pbmRleC1ydWxlcycsIHtcbiAgICAgICAgZGVzY3JpcHRpb246ICdBZGRzIGtleS9pbmRleCBkZXRhaWxzIHRvIGlPUyBtb2RlbHMnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgaGlkZGVuOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ21vZGVsLWVtaXQtYXV0aC1wcm92aWRlcicsIHtcbiAgICAgICAgZGVzY3JpcHRpb246ICdBZGRzIGF1dGggcHJvdmlkZXIgZGV0YWlscyB0byBpT1MgbW9kZWxzJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1yZXNwZWN0LXByaW1hcnkta2V5LWF0dHJpYnV0ZXMtb24tY29ubmVjdGlvbi1maWVsZCcsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0lmIGVuYWJsZWQsIERhdGFzdG9yZSBxdWVyaWVzIHdpbGwgcmVzcGVjdCB0aGUgcHJpbWFyeSArIHNvcnQga2V5IGZpZWxkcywgcmF0aGVyIHRoYW4gYSBkZWZhdWx0IGlkIGZpZWxkJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1nZW5lcmF0ZS1tb2RlbHMtZm9yLWxhenktbG9hZC1hbmQtY3VzdG9tLXNlbGVjdGlvbi1zZXQnLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICdHZW5lcmF0ZXMgbGF6eSBtb2RlbCB0eXBlIGRlZmluaXRpb25zLCByZXF1aXJlZCBvciBhbXBsaWZ5LWpzIHY1KycsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBoaWRkZW46IHRydWUsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignbW9kZWwtYWRkLXRpbWVzdGFtcC1maWVsZHMnLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQWRkIHJlYWQtb25seSB0aW1lc3RhbXAgZmllbGRzIGluIG1vZGVsZ2VuLicsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBoaWRkZW46IHRydWUsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignbW9kZWwtaGFuZGxlLWxpc3QtbnVsbGFiaWxpdHktdHJhbnNwYXJlbnRseScsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0NvbmZpZ3VyZSB0aGUgbnVsbGFiaWxpdHkgb2YgdGhlIExpc3QgYW5kIExpc3QgY29tcG9uZW50cyBpbiBEYXRhc3RvcmUgTW9kZWxzIGdlbmVyYXRpb24nLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgaGlkZGVuOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ3N0YXRlbWVudC1tYXgtZGVwdGgnLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICdEZXRlcm1pbmVzIGhvdyBkZWVwbHkgbmVzdGVkIHRvIGdlbmVyYXRlIGdyYXBocWwgc3RhdGVtZW50cy4nLFxuICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBoaWRkZW46IHRydWUsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignc3RhdGVtZW50LXR5cGVuYW1lLWludHJvc3BlY3Rpb24nLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICdEZXRlcm1pbmVzIHdoZXRoZXIgdG8gaW5jbHVkZSBkZWZhdWx0IF9fdHlwZW5hbWUgZm9yIGFsbCBnZW5lcmF0ZWQgc3RhdGVtZW50cycsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBoaWRkZW46IHRydWUsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbigndHlwZS1tdWx0aXBsZS1zd2lmdC1maWxlcycsIHtcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgJ0RldGVybWluZXMgd2hldGhlciBvciBub3QgdG8gZ2VuZXJhdGUgYSBzaW5nbGUgQVBJLnN3aWZ0LCBvciBtdWx0aXBsZSBwZXItbW9kZWwgc3dpZnQgZmlsZXMuJyxcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAuc2hvd0hpZGRlbignYWxsJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFByb2R1Y2UgdGhlIHJlcXVpcmVkIGlucHV0IGZvciBncmFwaHFsLWNvZGVnZW4gY2FsbHMgZnJvbSB0aGUgQ0xJIGlucHV0LCBhcHBseWluZyBzYW5lIGRlZmF1bHRzIHdoZXJlIGFwcGxpY2FibGUuXG4gICAqIEBwYXJhbSBhcmdzIENMSSBhcmdzIHByb3ZpZGVkIGJ5IHRoZSBjdXN0b21lclxuICAgKiBAcmV0dXJucyB0aGUgY29kZWdlbiBvcHRpb25zIGNvbmZpZ1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRHcmFwaHFsQ29kZWdlbkZvcm1hdFBhcmFtcyA9IChcbiAgICBhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnNcbiAgKTogR2VuZXJhdGVHcmFwaHFsQ29kZWdlbk9wdGlvbnMgPT4ge1xuICAgIGNvbnN0IHN0YXRlbWVudFRhcmdldDogR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0ID1cbiAgICAgIGFyZ3NbJ3N0YXRlbWVudC10YXJnZXQnXSA/PyBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQuVFlQRVNDUklQVDtcbiAgICBjb25zdCB0eXBlVGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0IHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ3R5cGUtdGFyZ2V0J10gPz9cbiAgICAgIERFRkFVTFRfVFlQRV9UQVJHRVRfRk9SX1NUQVRFTUVOVF9UQVJHRVRbc3RhdGVtZW50VGFyZ2V0XTtcbiAgICBjb25zdCBtYXhEZXB0aDogbnVtYmVyIHwgdW5kZWZpbmVkID0gYXJnc1snc3RhdGVtZW50LW1heC1kZXB0aCddO1xuICAgIGNvbnN0IHR5cGVOYW1lSW50cm9zcGVjdGlvbjogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydzdGF0ZW1lbnQtdHlwZW5hbWUtaW50cm9zcGVjdGlvbiddO1xuICAgIGNvbnN0IG11bHRpcGxlU3dpZnRGaWxlczogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWyd0eXBlLW11bHRpcGxlLXN3aWZ0LWZpbGVzJ107XG5cbiAgICByZXR1cm4ge1xuICAgICAgZm9ybWF0OiBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuR1JBUEhRTF9DT0RFR0VOLFxuICAgICAgc3RhdGVtZW50VGFyZ2V0LFxuICAgICAgLi4uKHR5cGVUYXJnZXQgIT09IHVuZGVmaW5lZCA/IHsgdHlwZVRhcmdldCB9IDoge30pLFxuICAgICAgLi4uKG1heERlcHRoICE9PSB1bmRlZmluZWQgPyB7IG1heERlcHRoIH0gOiB7fSksXG4gICAgICAuLi4odHlwZU5hbWVJbnRyb3NwZWN0aW9uICE9PSB1bmRlZmluZWQgPyB7IHR5cGVOYW1lSW50cm9zcGVjdGlvbiB9IDoge30pLFxuICAgICAgLi4uKG11bHRpcGxlU3dpZnRGaWxlcyAhPT0gdW5kZWZpbmVkID8geyBtdWx0aXBsZVN3aWZ0RmlsZXMgfSA6IHt9KSxcbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcm9kdWNlIHRoZSByZXF1aXJlZCBpbnB1dCBmb3IgbW9kZWxnZW4gY2FsbHMgZnJvbSB0aGUgQ0xJIGlucHV0LCBhcHBseWluZyBzYW5lIGRlZmF1bHRzIHdoZXJlIGFwcGxpY2FibGUuXG4gICAqIEBwYXJhbSBhcmdzIENMSSBhcmdzIHByb3ZpZGVkIGJ5IHRoZSBjdXN0b21lclxuICAgKiBAcmV0dXJucyB0aGUgbW9kZWxnZW4gb3B0aW9ucyBjb25maWdcbiAgICovXG4gIHByaXZhdGUgZ2V0TW9kZWxnZW5Gb3JtYXRQYXJhbXMgPSAoXG4gICAgYXJnczogR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zXG4gICk6IEdlbmVyYXRlTW9kZWxzT3B0aW9ucyA9PiB7XG4gICAgY29uc3QgbW9kZWxUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0ID1cbiAgICAgIGFyZ3NbJ21vZGVsLXRhcmdldCddID8/IEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0LlRZUEVTQ1JJUFQ7XG4gICAgY29uc3QgZ2VuZXJhdGVJbmRleFJ1bGVzOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLWdlbmVyYXRlLWluZGV4LXJ1bGVzJ107XG4gICAgY29uc3QgZW1pdEF1dGhQcm92aWRlcjogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydtb2RlbC1lbWl0LWF1dGgtcHJvdmlkZXInXTtcbiAgICBjb25zdCByZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZDogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydtb2RlbC1yZXNwZWN0LXByaW1hcnkta2V5LWF0dHJpYnV0ZXMtb24tY29ubmVjdGlvbi1maWVsZCddO1xuICAgIGNvbnN0IGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQ6IGJvb2xlYW4gfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1snbW9kZWwtZ2VuZXJhdGUtbW9kZWxzLWZvci1sYXp5LWxvYWQtYW5kLWN1c3RvbS1zZWxlY3Rpb24tc2V0J107XG4gICAgY29uc3QgYWRkVGltZXN0YW1wRmllbGRzOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLWFkZC10aW1lc3RhbXAtZmllbGRzJ107XG4gICAgY29uc3QgaGFuZGxlTGlzdE51bGxhYmlsaXR5VHJhbnNwYXJlbnRseTogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydtb2RlbC1oYW5kbGUtbGlzdC1udWxsYWJpbGl0eS10cmFuc3BhcmVudGx5J107XG5cbiAgICByZXR1cm4ge1xuICAgICAgZm9ybWF0OiBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuTU9ERUxHRU4sXG4gICAgICBtb2RlbFRhcmdldCxcbiAgICAgIC4uLihnZW5lcmF0ZUluZGV4UnVsZXMgIT09IHVuZGVmaW5lZCA/IHsgZ2VuZXJhdGVJbmRleFJ1bGVzIH0gOiB7fSksXG4gICAgICAuLi4oZW1pdEF1dGhQcm92aWRlciAhPT0gdW5kZWZpbmVkID8geyBlbWl0QXV0aFByb3ZpZGVyIH0gOiB7fSksXG4gICAgICAuLi4ocmVzcGVjdFByaW1hcnlLZXlBdHRyaWJ1dGVzT25Db25uZWN0aW9uRmllbGQgIT09IHVuZGVmaW5lZFxuICAgICAgICA/IHsgcmVzcGVjdFByaW1hcnlLZXlBdHRyaWJ1dGVzT25Db25uZWN0aW9uRmllbGQgfVxuICAgICAgICA6IHt9KSxcbiAgICAgIC4uLihnZW5lcmF0ZU1vZGVsc0ZvckxhenlMb2FkQW5kQ3VzdG9tU2VsZWN0aW9uU2V0ICE9PSB1bmRlZmluZWRcbiAgICAgICAgPyB7IGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQgfVxuICAgICAgICA6IHt9KSxcbiAgICAgIC4uLihhZGRUaW1lc3RhbXBGaWVsZHMgIT09IHVuZGVmaW5lZCA/IHsgYWRkVGltZXN0YW1wRmllbGRzIH0gOiB7fSksXG4gICAgICAuLi4oaGFuZGxlTGlzdE51bGxhYmlsaXR5VHJhbnNwYXJlbnRseSAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8geyBoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5IH1cbiAgICAgICAgOiB7fSksXG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogUHJvZHVjZSB0aGUgaW50cm9zcGVjdGlvbiBzY2hlbWEgY29uZmlnIHNoYXBlLlxuICAgKiBAcmV0dXJucyB0aGUgaW50cm9zcGVjdGlvbiBvcHRpb25zIGNvbmZpZ1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRJbnRyb3NwZWN0aW9uRm9ybWF0UGFyYW1zID0gKCk6IEdlbmVyYXRlSW50cm9zcGVjdGlvbk9wdGlvbnMgPT4gKHtcbiAgICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5JTlRST1NQRUNUSU9OLFxuICB9KTtcblxuICBwcml2YXRlIGdldE91dERpciA9IChhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnMpID0+IHtcbiAgICBjb25zdCBjd2QgPSBwcm9jZXNzLmN3ZCgpO1xuICAgIGlmICghYXJncy5vdXQpIHtcbiAgICAgIHJldHVybiBjd2Q7XG4gICAgfVxuICAgIHJldHVybiBpc0Fic29sdXRlKGFyZ3Mub3V0KSA/IGFyZ3Mub3V0IDogcmVzb2x2ZShjd2QsIGFyZ3Mub3V0KTtcbiAgfTtcblxuICAvLyBUaGlzIHByb3BlcnR5IHJlZmVyZW5jZXMgb3RoZXIgbWV0aG9kcyBpbiB0aGUgY2xhc3Mgc28gaXQgbXVzdCBiZSBkZWZpbmVkIGF0IHRoZSBlbmQuXG4gIC8vIFRoaXMgaXMgcHJvYmFibHkgYW4gaW5kaWNhdG9yIHRoYXQgc29tZSByZWZhY3RvcmluZyBzaG91bGQgaGFwcGVuIGhlcmUgYnV0IHJpZ2h0IG5vdyBJJ20ganVzdCB0cnlpbmcgdG8gYXBwbHkgdGhpcyBsaW50IHJ1bGUgdG8gdGhlIGNvZGViYXNlXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbWVtYmVyLW9yZGVyaW5nXG4gIHByaXZhdGUgZm9ybWF0UGFyYW1CdWlsZGVyczogUmVjb3JkPFxuICAgIEdlbmVyYXRlQXBpQ29kZUZvcm1hdCxcbiAgICAoYXJnczogR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zKSA9PiBHZW5lcmF0ZU9wdGlvbnNcbiAgPiA9IHtcbiAgICBbR2VuZXJhdGVBcGlDb2RlRm9ybWF0Lk1PREVMR0VOXTogdGhpcy5nZXRNb2RlbGdlbkZvcm1hdFBhcmFtcyxcbiAgICBbR2VuZXJhdGVBcGlDb2RlRm9ybWF0LkdSQVBIUUxfQ09ERUdFTl06IHRoaXMuZ2V0R3JhcGhxbENvZGVnZW5Gb3JtYXRQYXJhbXMsXG4gICAgW0dlbmVyYXRlQXBpQ29kZUZvcm1hdC5JTlRST1NQRUNUSU9OXTogdGhpcy5nZXRJbnRyb3NwZWN0aW9uRm9ybWF0UGFyYW1zLFxuICB9O1xufVxuIl19