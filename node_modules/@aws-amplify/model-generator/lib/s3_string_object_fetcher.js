import { GetObjectCommand } from '@aws-sdk/client-s3';
/**
 * Handles fetching an object from an s3 bucket and parsing the object contents to a string
 */
export class S3StringObjectFetcher {
    s3Client;
    /**
     * Creates an S3StringObjectFetcher with the provided s3 client
     */
    constructor(s3Client) {
        this.s3Client = s3Client;
    }
    /**
     * Fetches an s3 object and converts its contents to a string
     */
    fetch = async (uri) => {
        const { bucket, key } = this.parseS3Uri(uri);
        const getSchemaCommandResult = await this.s3Client.send(new GetObjectCommand({ Bucket: bucket, Key: key }));
        const schema = await getSchemaCommandResult.Body?.transformToString();
        if (!schema) {
            throw new Error('Error on parsing output schema');
        }
        return schema;
    };
    parseS3Uri = (uri) => {
        const { hostname, pathname } = new URL(uri);
        return {
            bucket: hostname,
            key: pathname.replace('/', ''),
        };
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiczNfc3RyaW5nX29iamVjdF9mZXRjaGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3MzX3N0cmluZ19vYmplY3RfZmV0Y2hlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQVksTUFBTSxvQkFBb0IsQ0FBQztBQUVoRTs7R0FFRztBQUNILE1BQU0sT0FBTyxxQkFBcUI7SUFJSDtJQUg3Qjs7T0FFRztJQUNILFlBQTZCLFFBQWtCO1FBQWxCLGFBQVEsR0FBUixRQUFRLENBQVU7SUFBRyxDQUFDO0lBRW5EOztPQUVHO0lBQ0gsS0FBSyxHQUFHLEtBQUssRUFBRSxHQUFXLEVBQUUsRUFBRTtRQUM1QixNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0MsTUFBTSxzQkFBc0IsR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNyRCxJQUFJLGdCQUFnQixDQUFDLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FDbkQsQ0FBQztRQUNGLE1BQU0sTUFBTSxHQUFHLE1BQU0sc0JBQXNCLENBQUMsSUFBSSxFQUFFLGlCQUFpQixFQUFFLENBQUM7UUFDdEUsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztTQUNuRDtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUMsQ0FBQztJQUVNLFVBQVUsR0FBRyxDQUFDLEdBQVcsRUFBbUMsRUFBRTtRQUNwRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLE9BQU87WUFDTCxNQUFNLEVBQUUsUUFBUTtZQUNoQixHQUFHLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO1NBQy9CLENBQUM7SUFDSixDQUFDLENBQUM7Q0FDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdldE9iamVjdENvbW1hbmQsIFMzQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXMzJztcblxuLyoqXG4gKiBIYW5kbGVzIGZldGNoaW5nIGFuIG9iamVjdCBmcm9tIGFuIHMzIGJ1Y2tldCBhbmQgcGFyc2luZyB0aGUgb2JqZWN0IGNvbnRlbnRzIHRvIGEgc3RyaW5nXG4gKi9cbmV4cG9ydCBjbGFzcyBTM1N0cmluZ09iamVjdEZldGNoZXIge1xuICAvKipcbiAgICogQ3JlYXRlcyBhbiBTM1N0cmluZ09iamVjdEZldGNoZXIgd2l0aCB0aGUgcHJvdmlkZWQgczMgY2xpZW50XG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHMzQ2xpZW50OiBTM0NsaWVudCkge31cblxuICAvKipcbiAgICogRmV0Y2hlcyBhbiBzMyBvYmplY3QgYW5kIGNvbnZlcnRzIGl0cyBjb250ZW50cyB0byBhIHN0cmluZ1xuICAgKi9cbiAgZmV0Y2ggPSBhc3luYyAodXJpOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCB7IGJ1Y2tldCwga2V5IH0gPSB0aGlzLnBhcnNlUzNVcmkodXJpKTtcbiAgICBjb25zdCBnZXRTY2hlbWFDb21tYW5kUmVzdWx0ID0gYXdhaXQgdGhpcy5zM0NsaWVudC5zZW5kKFxuICAgICAgbmV3IEdldE9iamVjdENvbW1hbmQoeyBCdWNrZXQ6IGJ1Y2tldCwgS2V5OiBrZXkgfSlcbiAgICApO1xuICAgIGNvbnN0IHNjaGVtYSA9IGF3YWl0IGdldFNjaGVtYUNvbW1hbmRSZXN1bHQuQm9keT8udHJhbnNmb3JtVG9TdHJpbmcoKTtcbiAgICBpZiAoIXNjaGVtYSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBvbiBwYXJzaW5nIG91dHB1dCBzY2hlbWEnKTtcbiAgICB9XG4gICAgcmV0dXJuIHNjaGVtYTtcbiAgfTtcblxuICBwcml2YXRlIHBhcnNlUzNVcmkgPSAodXJpOiBzdHJpbmcpOiB7IGJ1Y2tldDogc3RyaW5nOyBrZXk6IHN0cmluZyB9ID0+IHtcbiAgICBjb25zdCB7IGhvc3RuYW1lLCBwYXRobmFtZSB9ID0gbmV3IFVSTCh1cmkpO1xuICAgIHJldHVybiB7XG4gICAgICBidWNrZXQ6IGhvc3RuYW1lLFxuICAgICAga2V5OiBwYXRobmFtZS5yZXBsYWNlKCcvJywgJycpLFxuICAgIH07XG4gIH07XG59XG4iXX0=