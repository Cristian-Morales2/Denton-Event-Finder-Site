import { createGraphqlModelsGenerator } from './create_graphql_models_generator.js';
import { createGraphqlTypesGenerator } from './create_graphql_types_generator.js';
import { createGraphqlDocumentGenerator } from './create_graphql_document_generator.js';
import { getOutputFileName } from '@aws-amplify/graphql-types-generator';
import path from 'path';
export var GenerateApiCodeFormat;
(function (GenerateApiCodeFormat) {
    GenerateApiCodeFormat["MODELGEN"] = "modelgen";
    GenerateApiCodeFormat["GRAPHQL_CODEGEN"] = "graphql-codegen";
    GenerateApiCodeFormat["INTROSPECTION"] = "introspection";
})(GenerateApiCodeFormat || (GenerateApiCodeFormat = {}));
export var GenerateApiCodeModelTarget;
(function (GenerateApiCodeModelTarget) {
    GenerateApiCodeModelTarget["JAVA"] = "java";
    GenerateApiCodeModelTarget["SWIFT"] = "swift";
    GenerateApiCodeModelTarget["JAVASCRIPT"] = "javascript";
    GenerateApiCodeModelTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeModelTarget["DART"] = "dart";
})(GenerateApiCodeModelTarget || (GenerateApiCodeModelTarget = {}));
export var GenerateApiCodeStatementTarget;
(function (GenerateApiCodeStatementTarget) {
    GenerateApiCodeStatementTarget["JAVASCRIPT"] = "javascript";
    GenerateApiCodeStatementTarget["GRAPHQL"] = "graphql";
    GenerateApiCodeStatementTarget["FLOW"] = "flow";
    GenerateApiCodeStatementTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeStatementTarget["ANGULAR"] = "angular";
})(GenerateApiCodeStatementTarget || (GenerateApiCodeStatementTarget = {}));
export var GenerateApiCodeTypeTarget;
(function (GenerateApiCodeTypeTarget) {
    GenerateApiCodeTypeTarget["JSON"] = "json";
    GenerateApiCodeTypeTarget["SWIFT"] = "swift";
    GenerateApiCodeTypeTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeTypeTarget["FLOW"] = "flow";
    GenerateApiCodeTypeTarget["SCALA"] = "scala";
    GenerateApiCodeTypeTarget["FLOW_MODERN"] = "flow-modern";
    GenerateApiCodeTypeTarget["ANGULAR"] = "angular";
})(GenerateApiCodeTypeTarget || (GenerateApiCodeTypeTarget = {}));
/**
 * Generate api code using Api Code Generator with default generators.
 */
export const generateApiCode = async (props) => {
    const backendIdentifier = props;
    return new ApiCodeGenerator(createGraphqlDocumentGenerator({
        backendIdentifier,
        awsClientProvider: props.awsClientProvider,
    }), createGraphqlTypesGenerator({
        backendIdentifier,
        awsClientProvider: props.awsClientProvider,
    }), createGraphqlModelsGenerator({
        backendIdentifier,
        awsClientProvider: props.awsClientProvider,
    })).generate(props);
};
/**
 * Generator for Api Code resources.
 */
export class ApiCodeGenerator {
    graphqlDocumentGenerator;
    graphqlTypesGenerator;
    graphqlModelsGenerator;
    /**
     * Construct generator, passing in nested generators.
     * @param graphqlDocumentGenerator the graphql document generator
     * @param graphqlTypesGenerator the type generator
     * @param graphqlModelsGenerator the model object generator
     */
    constructor(graphqlDocumentGenerator, graphqlTypesGenerator, graphqlModelsGenerator) {
        this.graphqlDocumentGenerator = graphqlDocumentGenerator;
        this.graphqlTypesGenerator = graphqlTypesGenerator;
        this.graphqlModelsGenerator = graphqlModelsGenerator;
    }
    /**
     * Execute the generation.
     * @param props the required generate options.
     * @returns a promise with the generation results
     */
    generate(props) {
        switch (props.format) {
            case 'graphql-codegen': {
                return this.generateGraphqlCodegenApiCode(props);
            }
            case 'modelgen': {
                return this.generateModelgenApiCode(props);
            }
            case 'introspection': {
                return this.generateIntrospectionApiCode();
            }
            default:
                throw new Error(`${props.format} is not a supported format.`);
        }
    }
    /**
     * Execute document, and optionally type generation with relevant targets, wiring through types into statements if possible.
     */
    async generateGraphqlCodegenApiCode(props) {
        const generateModelsParams = {
            targetFormat: props.statementTarget,
            maxDepth: props.maxDepth,
            typenameIntrospection: props.typeNameIntrospection,
        };
        if (props.statementTarget === GenerateApiCodeStatementTarget.TYPESCRIPT &&
            props.typeTarget === GenerateApiCodeTypeTarget.TYPESCRIPT) {
            // Cast to unknown to string since the original input to this is typed as a required string, but expects an optional
            // value, and we want to rely on that behavior.
            const typeOutputFilepath = getOutputFileName(null, props.typeTarget);
            const fileName = path.parse(typeOutputFilepath).name;
            // This is an node import path, so we don't want to use path.join, since that'll produce invalid paths on windows platforms
            // Hard-coding since this method explicitly writes to the same directory if types are enabled.
            generateModelsParams.relativeTypesPath = `./${fileName}`;
        }
        const documents = await this.graphqlDocumentGenerator.generateModels(generateModelsParams);
        if (props.typeTarget) {
            const types = await this.graphqlTypesGenerator.generateTypes({
                target: props.typeTarget,
                multipleSwiftFiles: props.multipleSwiftFiles,
                maxDepth: props.maxDepth,
                typenameIntrospection: props.typeNameIntrospection,
            });
            return {
                writeToDirectory: async (directoryPath) => {
                    const filesWritten = [];
                    const { filesWritten: documentsFilesWritten } = await documents.writeToDirectory(directoryPath);
                    const { filesWritten: typesFilesWritten } = await types.writeToDirectory(directoryPath);
                    filesWritten.push(...documentsFilesWritten, ...typesFilesWritten);
                    return {
                        filesWritten,
                    };
                },
                getResults: async () => ({
                    ...(await documents.getResults()),
                    ...(await types.getResults()),
                }),
            };
        }
        return documents;
    }
    /**
     * Execute model generation with model target.
     */
    async generateModelgenApiCode(props) {
        return this.graphqlModelsGenerator.generateModels({
            target: props.modelTarget,
            generateIndexRules: props.generateIndexRules,
            emitAuthProvider: props.emitAuthProvider,
            useExperimentalPipelinedTransformer: props.useExperimentalPipelinedTransformer,
            transformerVersion: props.transformerVersion,
            respectPrimaryKeyAttributesOnConnectionField: props.respectPrimaryKeyAttributesOnConnectionField,
            generateModelsForLazyLoadAndCustomSelectionSet: props.generateModelsForLazyLoadAndCustomSelectionSet,
            addTimestampFields: props.addTimestampFields,
            handleListNullabilityTransparently: props.handleListNullabilityTransparently,
        });
    }
    /**
     * Execute model generation with introspection target.
     */
    async generateIntrospectionApiCode() {
        return this.graphqlModelsGenerator.generateModels({
            target: 'introspection',
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVfYXBpX2NvZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZ2VuZXJhdGVfYXBpX2NvZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBUUEsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDcEYsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDbEYsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDeEYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDekUsT0FBTyxJQUFJLE1BQU0sTUFBTSxDQUFDO0FBT3hCLE1BQU0sQ0FBTixJQUFZLHFCQUlYO0FBSkQsV0FBWSxxQkFBcUI7SUFDL0IsOENBQXFCLENBQUE7SUFDckIsNERBQW1DLENBQUE7SUFDbkMsd0RBQStCLENBQUE7QUFDakMsQ0FBQyxFQUpXLHFCQUFxQixLQUFyQixxQkFBcUIsUUFJaEM7QUFFRCxNQUFNLENBQU4sSUFBWSwwQkFNWDtBQU5ELFdBQVksMEJBQTBCO0lBQ3BDLDJDQUFhLENBQUE7SUFDYiw2Q0FBZSxDQUFBO0lBQ2YsdURBQXlCLENBQUE7SUFDekIsdURBQXlCLENBQUE7SUFDekIsMkNBQWEsQ0FBQTtBQUNmLENBQUMsRUFOVywwQkFBMEIsS0FBMUIsMEJBQTBCLFFBTXJDO0FBRUQsTUFBTSxDQUFOLElBQVksOEJBTVg7QUFORCxXQUFZLDhCQUE4QjtJQUN4QywyREFBeUIsQ0FBQTtJQUN6QixxREFBbUIsQ0FBQTtJQUNuQiwrQ0FBYSxDQUFBO0lBQ2IsMkRBQXlCLENBQUE7SUFDekIscURBQW1CLENBQUE7QUFDckIsQ0FBQyxFQU5XLDhCQUE4QixLQUE5Qiw4QkFBOEIsUUFNekM7QUFFRCxNQUFNLENBQU4sSUFBWSx5QkFRWDtBQVJELFdBQVkseUJBQXlCO0lBQ25DLDBDQUFhLENBQUE7SUFDYiw0Q0FBZSxDQUFBO0lBQ2Ysc0RB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LENBQUMsZ0JBQWdCO1lBQ3hDLG1DQUFtQyxFQUNqQyxLQUFLLENBQUMsbUNBQW1DO1lBQzNDLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxrQkFBa0I7WUFDNUMsNENBQTRDLEVBQzFDLEtBQUssQ0FBQyw0Q0FBNEM7WUFDcEQsOENBQThDLEVBQzVDLEtBQUssQ0FBQyw4Q0FBOEM7WUFDdEQsa0JBQWtCLEVBQUUsS0FBSyxDQUFDLGtCQUFrQjtZQUM1QyxrQ0FBa0MsRUFDaEMsS0FBSyxDQUFDLGtDQUFrQztTQUMzQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsNEJBQTRCO1FBQ3hDLE9BQU8sSUFBSSxDQUFDLHNCQUFzQixDQUFDLGNBQWMsQ0FBQztZQUNoRCxNQUFNLEVBQUUsZUFBZTtTQUN4QixDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBEb2N1bWVudEdlbmVyYXRpb25QYXJhbWV0ZXJzLFxuICBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuVG9GaWxlUmVzdWx0LFxuICBHZW5lcmF0aW9uUmVzdWx0LFxuICBHcmFwaHFsRG9jdW1lbnRHZW5lcmF0b3IsXG4gIEdyYXBocWxNb2RlbHNHZW5lcmF0b3IsXG4gIEdyYXBocWxUeXBlc0dlbmVyYXRvcixcbn0gZnJvbSAnLi9tb2RlbF9nZW5lcmF0b3IuanMnO1xuaW1wb3J0IHsgY3JlYXRlR3JhcGhxbE1vZGVsc0dlbmVyYXRvciB9IGZyb20gJy4vY3JlYXRlX2dyYXBocWxfbW9kZWxzX2dlbmVyYXRvci5qcyc7XG5pbXBvcnQgeyBjcmVhdGVHcmFwaHFsVHlwZXNHZW5lcmF0b3IgfSBmcm9tICcuL2NyZWF0ZV9ncmFwaHFsX3R5cGVzX2dlbmVyYXRvci5qcyc7XG5pbXBvcnQgeyBjcmVhdGVHcmFwaHFsRG9jdW1lbnRHZW5lcmF0b3IgfSBmcm9tICcuL2NyZWF0ZV9ncmFwaHFsX2RvY3VtZW50X2dlbmVyYXRvci5qcyc7XG5pbXBvcnQgeyBnZXRPdXRwdXRGaWxlTmFtZSB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9ncmFwaHFsLXR5cGVzLWdlbmVyYXRvcic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IERlcGxveWVkQmFja2VuZElkZW50aWZpZXIgfSBmcm9tICdAYXdzLWFtcGxpZnkvZGVwbG95ZWQtYmFja2VuZC1jbGllbnQnO1xuaW1wb3J0IHsgQVdTQ2xpZW50UHJvdmlkZXIgfSBmcm9tICdAYXdzLWFtcGxpZnkvcGx1Z2luLXR5cGVzJztcbmltcG9ydCB7IEFtcGxpZnlDbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtYW1wbGlmeSc7XG5pbXBvcnQgeyBDbG91ZEZvcm1hdGlvbkNsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1jbG91ZGZvcm1hdGlvbic7XG5pbXBvcnQgeyBTM0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XG5cbmV4cG9ydCBlbnVtIEdlbmVyYXRlQXBpQ29kZUZvcm1hdCB7XG4gIE1PREVMR0VOID0gJ21vZGVsZ2VuJyxcbiAgR1JBUEhRTF9DT0RFR0VOID0gJ2dyYXBocWwtY29kZWdlbicsXG4gIElOVFJPU1BFQ1RJT04gPSAnaW50cm9zcGVjdGlvbicsXG59XG5cbmV4cG9ydCBlbnVtIEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0IHtcbiAgSkFWQSA9ICdqYXZhJyxcbiAgU1dJRlQgPSAnc3dpZnQnLFxuICBKQVZBU0NSSVBUID0gJ2phdmFzY3JpcHQnLFxuICBUWVBFU0NSSVBUID0gJ3R5cGVzY3JpcHQnLFxuICBEQVJUID0gJ2RhcnQnLFxufVxuXG5leHBvcnQgZW51bSBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQge1xuICBKQVZBU0NSSVBUID0gJ2phdmFzY3JpcHQnLFxuICBHUkFQSFFMID0gJ2dyYXBocWwnLFxuICBGTE9XID0gJ2Zsb3cnLFxuICBUWVBFU0NSSVBUID0gJ3R5cGVzY3JpcHQnLFxuICBBTkdVTEFSID0gJ2FuZ3VsYXInLFxufVxuXG5leHBvcnQgZW51bSBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0IHtcbiAgSlNPTiA9ICdqc29uJyxcbiAgU1dJRlQgPSAnc3dpZnQnLFxuICBUWVBFU0NSSVBUID0gJ3R5cGVzY3JpcHQnLFxuICBGTE9XID0gJ2Zsb3cnLFxuICBTQ0FMQSA9ICdzY2FsYScsXG4gIEZMT1dfTU9ERVJOID0gJ2Zsb3ctbW9kZXJuJyxcbiAgQU5HVUxBUiA9ICdhbmd1bGFyJyxcbn1cblxuZXhwb3J0IHR5cGUgR2VuZXJhdGVNb2RlbHNPcHRpb25zID0ge1xuICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5NT0RFTEdFTjtcbiAgbW9kZWxUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0O1xuICBnZW5lcmF0ZUluZGV4UnVsZXM/OiBib29sZWFuO1xuICBlbWl0QXV0aFByb3ZpZGVyPzogYm9vbGVhbjtcbiAgdXNlRXhwZXJpbWVudGFsUGlwZWxpbmVkVHJhbnNmb3JtZXI/OiBib29sZWFuO1xuICB0cmFuc2Zvcm1lclZlcnNpb24/OiBudW1iZXI7XG4gIHJlc3BlY3RQcmltYXJ5S2V5QXR0cmlidXRlc09uQ29ubmVjdGlvbkZpZWxkPzogYm9vbGVhbjtcbiAgZ2VuZXJhdGVNb2RlbHNGb3JMYXp5TG9hZEFuZEN1c3RvbVNlbGVjdGlvblNldD86IGJvb2xlYW47XG4gIGFkZFRpbWVzdGFtcEZpZWxkcz86IGJvb2xlYW47XG4gIGhhbmRsZUxpc3ROdWxsYWJpbGl0eVRyYW5zcGFyZW50bHk/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IHR5cGUgR2VuZXJhdGVHcmFwaHFsQ29kZWdlbk9wdGlvbnMgPSB7XG4gIGZvcm1hdDogR2VuZXJhdGVBcGlDb2RlRm9ybWF0LkdSQVBIUUxfQ09ERUdFTjtcbiAgc3RhdGVtZW50VGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQ7XG4gIG1heERlcHRoPzogbnVtYmVyO1xuICB0eXBlTmFtZUludHJvc3BlY3Rpb24/OiBib29sZWFuO1xuICB0eXBlVGFyZ2V0PzogR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldDtcbiAgbXVsdGlwbGVTd2lmdEZpbGVzPzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCB0eXBlIEdlbmVyYXRlSW50cm9zcGVjdGlvbk9wdGlvbnMgPSB7XG4gIGZvcm1hdDogR2VuZXJhdGVBcGlDb2RlRm9ybWF0LklOVFJPU1BFQ1RJT047XG59O1xuXG5leHBvcnQgdHlwZSBHZW5lcmF0ZU9wdGlvbnMgPVxuICB8IEdlbmVyYXRlR3JhcGhxbENvZGVnZW5PcHRpb25zXG4gIHwgR2VuZXJhdGVNb2RlbHNPcHRpb25zXG4gIHwgR2VuZXJhdGVJbnRyb3NwZWN0aW9uT3B0aW9ucztcblxuZXhwb3J0IHR5cGUgR2VuZXJhdGVBcGlDb2RlUHJvcHMgPSBHZW5lcmF0ZU9wdGlvbnMgJlxuICBEZXBsb3llZEJhY2tlbmRJZGVudGlmaWVyICYge1xuICAgIGF3c0NsaWVudFByb3ZpZGVyOiBBV1NDbGllbnRQcm92aWRlcjx7XG4gICAgICBnZXRBbXBsaWZ5Q2xpZW50OiBBbXBsaWZ5Q2xpZW50O1xuICAgICAgZ2V0Q2xvdWRGb3JtYXRpb25DbGllbnQ6IENsb3VkRm9ybWF0aW9uQ2xpZW50O1xuICAgICAgZ2V0UzNDbGllbnQ6IFMzQ2xpZW50O1xuICAgIH0+O1xuICB9O1xuXG4vKipcbiAqIEdlbmVyYXRlIGFwaSBjb2RlIHVzaW5nIEFwaSBDb2RlIEdlbmVyYXRvciB3aXRoIGRlZmF1bHQgZ2VuZXJhdG9ycy5cbiAqL1xuZXhwb3J0IGNvbnN0IGdlbmVyYXRlQXBpQ29kZSA9IGFzeW5jIChcbiAgcHJvcHM6IEdlbmVyYXRlQXBpQ29kZVByb3BzXG4pOiBQcm9taXNlPEdlbmVyYXRpb25SZXN1bHQ+ID0+IHtcbiAgY29uc3QgYmFja2VuZElkZW50aWZpZXIgPSBwcm9wcztcbiAgcmV0dXJuIG5ldyBBcGlDb2RlR2VuZXJhdG9yKFxuICAgIGNyZWF0ZUdyYXBocWxEb2N1bWVudEdlbmVyYXRvcih7XG4gICAgICBiYWNrZW5kSWRlbnRpZmllcixcbiAgICAgIGF3c0NsaWVudFByb3ZpZGVyOiBwcm9wcy5hd3NDbGllbnRQcm92aWRlcixcbiAgICB9KSxcbiAgICBjcmVhdGVHcmFwaHFsVHlwZXNHZW5lcmF0b3Ioe1xuICAgICAgYmFja2VuZElkZW50aWZpZXIsXG4gICAgICBhd3NDbGllbnRQcm92aWRlcjogcHJvcHMuYXdzQ2xpZW50UHJvdmlkZXIsXG4gICAgfSksXG4gICAgY3JlYXRlR3JhcGhxbE1vZGVsc0dlbmVyYXRvcih7XG4gICAgICBiYWNrZW5kSWRlbnRpZmllcixcbiAgICAgIGF3c0NsaWVudFByb3ZpZGVyOiBwcm9wcy5hd3NDbGllbnRQcm92aWRlcixcbiAgICB9KVxuICApLmdlbmVyYXRlKHByb3BzKTtcbn07XG5cbi8qKlxuICogR2VuZXJhdG9yIGZvciBBcGkgQ29kZSByZXNvdXJjZXMuXG4gKi9cbmV4cG9ydCBjbGFzcyBBcGlDb2RlR2VuZXJhdG9yIHtcbiAgLyoqXG4gICAqIENvbnN0cnVjdCBnZW5lcmF0b3IsIHBhc3NpbmcgaW4gbmVzdGVkIGdlbmVyYXRvcnMuXG4gICAqIEBwYXJhbSBncmFwaHFsRG9jdW1lbnRHZW5lcmF0b3IgdGhlIGdyYXBocWwgZG9jdW1lbnQgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBncmFwaHFsVHlwZXNHZW5lcmF0b3IgdGhlIHR5cGUgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBncmFwaHFsTW9kZWxzR2VuZXJhdG9yIHRoZSBtb2RlbCBvYmplY3QgZ2VuZXJhdG9yXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdyYXBocWxEb2N1bWVudEdlbmVyYXRvcjogR3JhcGhxbERvY3VtZW50R2VuZXJhdG9yLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZ3JhcGhxbFR5cGVzR2VuZXJhdG9yOiBHcmFwaHFsVHlwZXNHZW5lcmF0b3IsXG4gICAgcHJpdmF0ZSByZWFkb25seSBncmFwaHFsTW9kZWxzR2VuZXJhdG9yOiBHcmFwaHFsTW9kZWxzR2VuZXJhdG9yXG4gICkge31cblxuICAvKipcbiAgICogRXhlY3V0ZSB0aGUgZ2VuZXJhdGlvbi5cbiAgICogQHBhcmFtIHByb3BzIHRoZSByZXF1aXJlZCBnZW5lcmF0ZSBvcHRpb25zLlxuICAgKiBAcmV0dXJucyBhIHByb21pc2Ugd2l0aCB0aGUgZ2VuZXJhdGlvbiByZXN1bHRzXG4gICAqL1xuICBnZW5lcmF0ZShwcm9wczogR2VuZXJhdGVPcHRpb25zKTogUHJvbWlzZTxHZW5lcmF0aW9uUmVzdWx0PiB7XG4gICAgc3dpdGNoIChwcm9wcy5mb3JtYXQpIHtcbiAgICAgIGNhc2UgJ2dyYXBocWwtY29kZWdlbic6IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVHcmFwaHFsQ29kZWdlbkFwaUNvZGUocHJvcHMpO1xuICAgICAgfVxuICAgICAgY2FzZSAnbW9kZWxnZW4nOiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlTW9kZWxnZW5BcGlDb2RlKHByb3BzKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2ludHJvc3BlY3Rpb24nOiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlSW50cm9zcGVjdGlvbkFwaUNvZGUoKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgJHtcbiAgICAgICAgICAgIChwcm9wcyBhcyBHZW5lcmF0ZUFwaUNvZGVQcm9wcykuZm9ybWF0IGFzIHN0cmluZ1xuICAgICAgICAgIH0gaXMgbm90IGEgc3VwcG9ydGVkIGZvcm1hdC5gXG4gICAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgZG9jdW1lbnQsIGFuZCBvcHRpb25hbGx5IHR5cGUgZ2VuZXJhdGlvbiB3aXRoIHJlbGV2YW50IHRhcmdldHMsIHdpcmluZyB0aHJvdWdoIHR5cGVzIGludG8gc3RhdGVtZW50cyBpZiBwb3NzaWJsZS5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVHcmFwaHFsQ29kZWdlbkFwaUNvZGUoXG4gICAgcHJvcHM6IEdlbmVyYXRlR3JhcGhxbENvZGVnZW5PcHRpb25zXG4gICk6IFByb21pc2U8R2VuZXJhdGlvblJlc3VsdD4ge1xuICAgIGNvbnN0IGdlbmVyYXRlTW9kZWxzUGFyYW1zOiBEb2N1bWVudEdlbmVyYXRpb25QYXJhbWV0ZXJzID0ge1xuICAgICAgdGFyZ2V0Rm9ybWF0OiBwcm9wcy5zdGF0ZW1lbnRUYXJnZXQsXG4gICAgICBtYXhEZXB0aDogcHJvcHMubWF4RGVwdGgsXG4gICAgICB0eXBlbmFtZUludHJvc3BlY3Rpb246IHByb3BzLnR5cGVOYW1lSW50cm9zcGVjdGlvbixcbiAgICB9O1xuICAgIGlmIChcbiAgICAgIHByb3BzLnN0YXRlbWVudFRhcmdldCA9PT0gR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LlRZUEVTQ1JJUFQgJiZcbiAgICAgIHByb3BzLnR5cGVUYXJnZXQgPT09IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQuVFlQRVNDUklQVFxuICAgICkge1xuICAgICAgLy8gQ2FzdCB0byB1bmtub3duIHRvIHN0cmluZyBzaW5jZSB0aGUgb3JpZ2luYWwgaW5wdXQgdG8gdGhpcyBpcyB0eXBlZCBhcyBhIHJlcXVpcmVkIHN0cmluZywgYnV0IGV4cGVjdHMgYW4gb3B0aW9uYWxcbiAgICAgIC8vIHZhbHVlLCBhbmQgd2Ugd2FudCB0byByZWx5IG9uIHRoYXQgYmVoYXZpb3IuXG4gICAgICBjb25zdCB0eXBlT3V0cHV0RmlsZXBhdGggPSBnZXRPdXRwdXRGaWxlTmFtZShcbiAgICAgICAgbnVsbCBhcyB1bmtub3duIGFzIHN0cmluZyxcbiAgICAgICAgcHJvcHMudHlwZVRhcmdldFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gcGF0aC5wYXJzZSh0eXBlT3V0cHV0RmlsZXBhdGgpLm5hbWU7XG4gICAgICAvLyBUaGlzIGlzIGFuIG5vZGUgaW1wb3J0IHBhdGgsIHNvIHdlIGRvbid0IHdhbnQgdG8gdXNlIHBhdGguam9pbiwgc2luY2UgdGhhdCdsbCBwcm9kdWNlIGludmFsaWQgcGF0aHMgb24gd2luZG93cyBwbGF0Zm9ybXNcbiAgICAgIC8vIEhhcmQtY29kaW5nIHNpbmNlIHRoaXMgbWV0aG9kIGV4cGxpY2l0bHkgd3JpdGVzIHRvIHRoZSBzYW1lIGRpcmVjdG9yeSBpZiB0eXBlcyBhcmUgZW5hYmxlZC5cbiAgICAgIGdlbmVyYXRlTW9kZWxzUGFyYW1zLnJlbGF0aXZlVHlwZXNQYXRoID0gYC4vJHtmaWxlTmFtZX1gO1xuICAgIH1cbiAgICBjb25zdCBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLmdyYXBocWxEb2N1bWVudEdlbmVyYXRvci5nZW5lcmF0ZU1vZGVscyhcbiAgICAgIGdlbmVyYXRlTW9kZWxzUGFyYW1zXG4gICAgKTtcblxuICAgIGlmIChwcm9wcy50eXBlVGFyZ2V0KSB7XG4gICAgICBjb25zdCB0eXBlcyA9IGF3YWl0IHRoaXMuZ3JhcGhxbFR5cGVzR2VuZXJhdG9yLmdlbmVyYXRlVHlwZXMoe1xuICAgICAgICB0YXJnZXQ6IHByb3BzLnR5cGVUYXJnZXQsXG4gICAgICAgIG11bHRpcGxlU3dpZnRGaWxlczogcHJvcHMubXVsdGlwbGVTd2lmdEZpbGVzLFxuICAgICAgICBtYXhEZXB0aDogcHJvcHMubWF4RGVwdGgsXG4gICAgICAgIHR5cGVuYW1lSW50cm9zcGVjdGlvbjogcHJvcHMudHlwZU5hbWVJbnRyb3NwZWN0aW9uLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdyaXRlVG9EaXJlY3Rvcnk6IGFzeW5jIChcbiAgICAgICAgICBkaXJlY3RvcnlQYXRoOiBzdHJpbmdcbiAgICAgICAgKTogUHJvbWlzZTxHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuVG9GaWxlUmVzdWx0PiA9PiB7XG4gICAgICAgICAgY29uc3QgZmlsZXNXcml0dGVuOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgIGNvbnN0IHsgZmlsZXNXcml0dGVuOiBkb2N1bWVudHNGaWxlc1dyaXR0ZW4gfSA9XG4gICAgICAgICAgICBhd2FpdCBkb2N1bWVudHMud3JpdGVUb0RpcmVjdG9yeShkaXJlY3RvcnlQYXRoKTtcbiAgICAgICAgICBjb25zdCB7IGZpbGVzV3JpdHRlbjogdHlwZXNGaWxlc1dyaXR0ZW4gfSA9XG4gICAgICAgICAgICBhd2FpdCB0eXBlcy53cml0ZVRvRGlyZWN0b3J5KGRpcmVjdG9yeVBhdGgpO1xuICAgICAgICAgIGZpbGVzV3JpdHRlbi5wdXNoKC4uLmRvY3VtZW50c0ZpbGVzV3JpdHRlbiwgLi4udHlwZXNGaWxlc1dyaXR0ZW4pO1xuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpbGVzV3JpdHRlbixcbiAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBnZXRSZXN1bHRzOiBhc3luYyAoKSA9PiAoe1xuICAgICAgICAgIC4uLihhd2FpdCBkb2N1bWVudHMuZ2V0UmVzdWx0cygpKSxcbiAgICAgICAgICAuLi4oYXdhaXQgdHlwZXMuZ2V0UmVzdWx0cygpKSxcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBkb2N1bWVudHM7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBtb2RlbCBnZW5lcmF0aW9uIHdpdGggbW9kZWwgdGFyZ2V0LlxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZU1vZGVsZ2VuQXBpQ29kZShcbiAgICBwcm9wczogR2VuZXJhdGVNb2RlbHNPcHRpb25zXG4gICk6IFByb21pc2U8R2VuZXJhdGlvblJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLmdyYXBocWxNb2RlbHNHZW5lcmF0b3IuZ2VuZXJhdGVNb2RlbHMoe1xuICAgICAgdGFyZ2V0OiBwcm9wcy5tb2RlbFRhcmdldCxcbiAgICAgIGdlbmVyYXRlSW5kZXhSdWxlczogcHJvcHMuZ2VuZXJhdGVJbmRleFJ1bGVzLFxuICAgICAgZW1pdEF1dGhQcm92aWRlcjogcHJvcHMuZW1pdEF1dGhQcm92aWRlcixcbiAgICAgIHVzZUV4cGVyaW1lbnRhbFBpcGVsaW5lZFRyYW5zZm9ybWVyOlxuICAgICAgICBwcm9wcy51c2VFeHBlcmltZW50YWxQaXBlbGluZWRUcmFuc2Zvcm1lcixcbiAgICAgIHRyYW5zZm9ybWVyVmVyc2lvbjogcHJvcHMudHJhbnNmb3JtZXJWZXJzaW9uLFxuICAgICAgcmVzcGVjdFByaW1hcnlLZXlBdHRyaWJ1dGVzT25Db25uZWN0aW9uRmllbGQ6XG4gICAgICAgIHByb3BzLnJlc3BlY3RQcmltYXJ5S2V5QXR0cmlidXRlc09uQ29ubmVjdGlvbkZpZWxkLFxuICAgICAgZ2VuZXJhdGVNb2RlbHNGb3JMYXp5TG9hZEFuZEN1c3RvbVNlbGVjdGlvblNldDpcbiAgICAgICAgcHJvcHMuZ2VuZXJhdGVNb2RlbHNGb3JMYXp5TG9hZEFuZEN1c3RvbVNlbGVjdGlvblNldCxcbiAgICAgIGFkZFRpbWVzdGFtcEZpZWxkczogcHJvcHMuYWRkVGltZXN0YW1wRmllbGRzLFxuICAgICAgaGFuZGxlTGlzdE51bGxhYmlsaXR5VHJhbnNwYXJlbnRseTpcbiAgICAgICAgcHJvcHMuaGFuZGxlTGlzdE51bGxhYmlsaXR5VHJhbnNwYXJlbnRseSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIG1vZGVsIGdlbmVyYXRpb24gd2l0aCBpbnRyb3NwZWN0aW9uIHRhcmdldC5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVJbnRyb3NwZWN0aW9uQXBpQ29kZSgpOiBQcm9taXNlPEdlbmVyYXRpb25SZXN1bHQ+IHtcbiAgICByZXR1cm4gdGhpcy5ncmFwaHFsTW9kZWxzR2VuZXJhdG9yLmdlbmVyYXRlTW9kZWxzKHtcbiAgICAgIHRhcmdldDogJ2ludHJvc3BlY3Rpb24nLFxuICAgIH0pO1xuICB9XG59XG4iXX0=