/**
 * Converts client config to a different shapes needed by mobile libraries for Gen1 format.
 */
export class ClientConfigMobileConverter {
    packageName;
    packageVersion;
    /**
     * Creates client config converter
     */
    constructor(packageName, packageVersion) {
        this.packageName = packageName;
        this.packageVersion = packageVersion;
    }
    /**
     * Converts client config to a shape consumable by mobile libraries.
     */
    convertToMobileConfig = (clientConfig) => {
        const userAgent = `${this.packageName}/${this.packageVersion}`;
        const mobileConfig = {
            UserAgent: userAgent,
            Version: '1.0',
        };
        if (clientConfig.aws_user_pools_id) {
            const authConfig = {
                plugins: {
                    awsCognitoAuthPlugin: {
                        UserAgent: userAgent,
                        Version: '1.0',
                        CognitoUserPool: {
                            Default: {
                                PoolId: clientConfig.aws_user_pools_id,
                                AppClientId: clientConfig.aws_user_pools_web_client_id,
                                Region: clientConfig.aws_cognito_region,
                            },
                        },
                        CredentialsProvider: {
                            CognitoIdentity: {
                                Default: {
                                    PoolId: clientConfig.aws_cognito_identity_pool_id,
                                    Region: clientConfig.aws_cognito_region,
                                },
                            },
                        },
                        Auth: {
                            Default: {
                                authenticationFlowType: 'USER_SRP_AUTH',
                                mfaConfiguration: clientConfig.aws_cognito_mfa_configuration,
                                mfaTypes: clientConfig.aws_cognito_mfa_types,
                                passwordProtectionSettings: {
                                    passwordPolicyMinLength: clientConfig.aws_cognito_password_protection_settings
                                        ?.passwordPolicyMinLength,
                                    passwordPolicyCharacters: clientConfig.aws_cognito_password_protection_settings
                                        ?.passwordPolicyCharacters ?? [],
                                },
                                signupAttributes: clientConfig.aws_cognito_signup_attributes ?? [],
                                usernameAttributes: clientConfig.aws_cognito_username_attributes ?? [],
                                verificationMechanisms: clientConfig.aws_cognito_verification_mechanisms ?? [],
                            },
                        },
                    },
                },
            };
            if (clientConfig.oauth) {
                authConfig.plugins.awsCognitoAuthPlugin.Auth.Default.OAuth = {
                    WebDomain: clientConfig.oauth.domain,
                    Scopes: clientConfig.oauth.scope,
                    SignInRedirectURI: clientConfig.oauth.redirectSignIn,
                    SignOutRedirectURI: clientConfig.oauth.redirectSignOut,
                    AppClientId: clientConfig.oauth.clientId,
                };
            }
            mobileConfig.auth = authConfig;
        }
        if (clientConfig.aws_appsync_graphqlEndpoint) {
            const apiConfig = {
                plugins: {
                    awsAPIPlugin: {
                        data: {
                            endpointType: 'GraphQL',
                            endpoint: clientConfig.aws_appsync_graphqlEndpoint,
                            region: clientConfig.aws_appsync_region,
                            authorizationType: clientConfig.aws_appsync_authenticationType,
                            apiKey: clientConfig.aws_appsync_apiKey,
                        },
                    },
                },
            };
            mobileConfig.api = apiConfig;
            if (mobileConfig.auth) {
                let defaultClientDatabasePrefix = undefined;
                if (clientConfig.aws_appsync_authenticationType) {
                    defaultClientDatabasePrefix = `data_${clientConfig.aws_appsync_authenticationType}`;
                }
                mobileConfig.auth.plugins.awsCognitoAuthPlugin.AppSync = {
                    Default: {
                        ApiUrl: clientConfig.aws_appsync_graphqlEndpoint,
                        Region: clientConfig.aws_appsync_region,
                        AuthMode: clientConfig.aws_appsync_authenticationType,
                        ApiKey: clientConfig.aws_appsync_apiKey,
                        ClientDatabasePrefix: defaultClientDatabasePrefix,
                    },
                };
                if (clientConfig.aws_appsync_additionalAuthenticationTypes) {
                    for (const additionalAuthenticationType of clientConfig.aws_appsync_additionalAuthenticationTypes.split(',')) {
                        mobileConfig.auth.plugins.awsCognitoAuthPlugin.AppSync[`data_${additionalAuthenticationType}`] = {
                            ApiUrl: clientConfig.aws_appsync_graphqlEndpoint,
                            Region: clientConfig.aws_appsync_region,
                            AuthMode: additionalAuthenticationType,
                            ApiKey: clientConfig.aws_appsync_apiKey,
                            ClientDatabasePrefix: `data_${additionalAuthenticationType}`,
                        };
                    }
                }
            }
        }
        if (clientConfig.geo) {
            const geoConfig = {
                plugins: {
                    awsLocationGeoPlugin: {
                        region: clientConfig.geo.amazon_location_service.region,
                    },
                },
            };
            const maps = clientConfig.geo.amazon_location_service.maps;
            if (maps) {
                geoConfig.plugins.awsLocationGeoPlugin.maps = maps;
            }
            const searchIndices = clientConfig.geo.amazon_location_service.search_indices;
            if (searchIndices) {
                geoConfig.plugins.awsLocationGeoPlugin.searchIndices = searchIndices;
            }
            mobileConfig.geo = geoConfig;
        }
        if (clientConfig.Analytics) {
            mobileConfig.analytics = {
                plugins: {
                    awsPinpointAnalyticsPlugin: {
                        pinpointAnalytics: {
                            region: clientConfig.Analytics.Pinpoint.region,
                            appId: clientConfig.Analytics.Pinpoint.appId,
                        },
                        pinpointTargeting: {
                            region: clientConfig.Analytics.Pinpoint.region,
                        },
                    },
                },
            };
        }
        if (clientConfig.Notifications) {
            mobileConfig.notifications = {
                plugins: {},
            };
            if (clientConfig.Notifications.SMS) {
                mobileConfig.notifications.plugins.awsPinpointSmsNotificationsPlugin =
                    clientConfig.Notifications.SMS.AWSPinpoint;
            }
            if (clientConfig.Notifications.EMAIL) {
                mobileConfig.notifications.plugins.awsPinpointEmailNotificationsPlugin =
                    clientConfig.Notifications.EMAIL.AWSPinpoint;
            }
            if (clientConfig.Notifications.InAppMessaging) {
                mobileConfig.notifications.plugins.awsPinpointInAppMessagingNotificationsPlugin =
                    clientConfig.Notifications.InAppMessaging.AWSPinpoint;
            }
            if (clientConfig.Notifications.Push) {
                mobileConfig.notifications.plugins.awsPinpointPushNotificationsPlugin =
                    clientConfig.Notifications.Push.AWSPinpoint;
            }
        }
        if (clientConfig.aws_user_files_s3_bucket) {
            mobileConfig.storage = {
                plugins: {
                    awsS3StoragePlugin: {
                        bucket: clientConfig.aws_user_files_s3_bucket,
                        region: clientConfig.aws_user_files_s3_bucket_region,
                    },
                },
            };
        }
        return mobileConfig;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50X2NvbmZpZ190b19tb2JpbGVfbGVnYWN5X2NvbnZlcnRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGllbnQtY29uZmlnLXdyaXRlci9jbGllbnRfY29uZmlnX3RvX21vYmlsZV9sZWdhY3lfY29udmVydGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVFBOztHQUVHO0FBQ0gsTUFBTSxPQUFPLDJCQUEyQjtJQUtuQjtJQUNBO0lBTG5COztPQUVHO0lBQ0gsWUFDbUIsV0FBbUIsRUFDbkIsY0FBc0I7UUFEdEIsZ0JBQVcsR0FBWCxXQUFXLENBQVE7UUFDbkIsbUJBQWMsR0FBZCxjQUFjLENBQVE7SUFDdEMsQ0FBQztJQUNKOztPQUVHO0lBQ0gscUJBQXFCLEdBQUcsQ0FDdEIsWUFBZ0MsRUFDWixFQUFFO1FBQ3RCLE1BQU0sU0FBUyxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFL0QsTUFBTSxZQUFZLEdBQXVCO1lBQ3ZDLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLE9BQU8sRUFBRSxLQUFLO1NBQ2YsQ0FBQztRQUNGLElBQUksWUFBWSxDQUFDLGlCQUFpQixFQUFFO1lBQ2xDLE1BQU0sVUFBVSxHQUEyQjtnQkFDekMsT0FBTyxFQUFFO29CQUNQLG9CQUFvQixFQUFFO3dCQUNwQixTQUFTLEVBQUUsU0FBUzt3QkFDcEIsT0FBTyxFQUFFLEtBQUs7d0JBQ2QsZUFBZSxFQUFFOzRCQUNmLE9BQU8sRUFBRTtnQ0FDUCxNQUFNLEVBQUUsWUFBWSxDQUFDLGlCQUFpQjtnQ0FDdEMsV0FBVyxFQUFFLFlBQVksQ0FBQyw0QkFBNEI7Z0NBQ3RELE1BQU0sRUFBRSxZQUFZLENBQUMsa0JBQWtCOzZCQUN4Qzt5QkFDRjt3QkFDRCxtQkFBbUIsRUFBRTs0QkFDbkIsZUFBZSxFQUFFO2dDQUNmLE9BQU8sRUFBRTtvQ0FDUCxNQUFNLEVBQUUsWUFBWSxDQUFDLDRCQUE0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N0MsTUFBTSxFQUFFLFlBQVksQ0FBQywrQkFBK0I7cUJBQ3JEO2lCQUNGO2FBQ0YsQ0FBQztTQUNIO1FBRUQsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQyxDQUFDO0NBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDbGllbnRDb25maWdMZWdhY3kgfSBmcm9tICcuLi9jbGllbnQtY29uZmlnLXR5cGVzL2NsaWVudF9jb25maWcuanMnO1xuaW1wb3J0IHtcbiAgQ2xpZW50Q29uZmlnTW9iaWxlLFxuICBDbGllbnRDb25maWdNb2JpbGVBcGksXG4gIENsaWVudENvbmZpZ01vYmlsZUF1dGgsXG4gIENsaWVudENvbmZpZ01vYmlsZUdlbyxcbn0gZnJvbSAnLi4vY2xpZW50LWNvbmZpZy10eXBlcy9tb2JpbGUvY2xpZW50X2NvbmZpZ19tb2JpbGVfdHlwZXMuanMnO1xuXG4vKipcbiAqIENvbnZlcnRzIGNsaWVudCBjb25maWcgdG8gYSBkaWZmZXJlbnQgc2hhcGVzIG5lZWRlZCBieSBtb2JpbGUgbGlicmFyaWVzIGZvciBHZW4xIGZvcm1hdC5cbiAqL1xuZXhwb3J0IGNsYXNzIENsaWVudENvbmZpZ01vYmlsZUNvbnZlcnRlciB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGNsaWVudCBjb25maWcgY29udmVydGVyXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHBhY2thZ2VOYW1lOiBzdHJpbmcsXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYWNrYWdlVmVyc2lvbjogc3RyaW5nXG4gICkge31cbiAgLyoqXG4gICAqIENvbnZlcnRzIGNsaWVudCBjb25maWcgdG8gYSBzaGFwZSBjb25zdW1hYmxlIGJ5IG1vYmlsZSBsaWJyYXJpZXMuXG4gICAqL1xuICBjb252ZXJ0VG9Nb2JpbGVDb25maWcgPSAoXG4gICAgY2xpZW50Q29uZmlnOiBDbGllbnRDb25maWdMZWdhY3lcbiAgKTogQ2xpZW50Q29uZmlnTW9iaWxlID0+IHtcbiAgICBjb25zdCB1c2VyQWdlbnQgPSBgJHt0aGlzLnBhY2thZ2VOYW1lfS8ke3RoaXMucGFja2FnZVZlcnNpb259YDtcblxuICAgIGNvbnN0IG1vYmlsZUNvbmZpZzogQ2xpZW50Q29uZmlnTW9iaWxlID0ge1xuICAgICAgVXNlckFnZW50OiB1c2VyQWdlbnQsXG4gICAgICBWZXJzaW9uOiAnMS4wJyxcbiAgICB9O1xuICAgIGlmIChjbGllbnRDb25maWcuYXdzX3VzZXJfcG9vbHNfaWQpIHtcbiAgICAgIGNvbnN0IGF1dGhDb25maWc6IENsaWVudENvbmZpZ01vYmlsZUF1dGggPSB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICBhd3NDb2duaXRvQXV0aFBsdWdpbjoge1xuICAgICAgICAgICAgVXNlckFnZW50OiB1c2VyQWdlbnQsXG4gICAgICAgICAgICBWZXJzaW9uOiAnMS4wJyxcbiAgICAgICAgICAgIENvZ25pdG9Vc2VyUG9vbDoge1xuICAgICAgICAgICAgICBEZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgUG9vbElkOiBjbGllbnRDb25maWcuYXdzX3VzZXJfcG9vbHNfaWQsXG4gICAgICAgICAgICAgICAgQXBwQ2xpZW50SWQ6IGNsaWVudENvbmZpZy5hd3NfdXNlcl9wb29sc193ZWJfY2xpZW50X2lkLFxuICAgICAgICAgICAgICAgIFJlZ2lvbjogY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX3JlZ2lvbixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBDcmVkZW50aWFsc1Byb3ZpZGVyOiB7XG4gICAgICAgICAgICAgIENvZ25pdG9JZGVudGl0eToge1xuICAgICAgICAgICAgICAgIERlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICAgIFBvb2xJZDogY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX2lkZW50aXR5X3Bvb2xfaWQsXG4gICAgICAgICAgICAgICAgICBSZWdpb246IGNsaWVudENvbmZpZy5hd3NfY29nbml0b19yZWdpb24sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBBdXRoOiB7XG4gICAgICAgICAgICAgIERlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvbkZsb3dUeXBlOiAnVVNFUl9TUlBfQVVUSCcsXG4gICAgICAgICAgICAgICAgbWZhQ29uZmlndXJhdGlvbjogY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX21mYV9jb25maWd1cmF0aW9uLFxuICAgICAgICAgICAgICAgIG1mYVR5cGVzOiBjbGllbnRDb25maWcuYXdzX2NvZ25pdG9fbWZhX3R5cGVzLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkUHJvdGVjdGlvblNldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICBwYXNzd29yZFBvbGljeU1pbkxlbmd0aDpcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX3Bhc3N3b3JkX3Byb3RlY3Rpb25fc2V0dGluZ3NcbiAgICAgICAgICAgICAgICAgICAgICA/LnBhc3N3b3JkUG9saWN5TWluTGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgcGFzc3dvcmRQb2xpY3lDaGFyYWN0ZXJzOlxuICAgICAgICAgICAgICAgICAgICBjbGllbnRDb25maWcuYXdzX2NvZ25pdG9fcGFzc3dvcmRfcHJvdGVjdGlvbl9zZXR0aW5nc1xuICAgICAgICAgICAgICAgICAgICAgID8ucGFzc3dvcmRQb2xpY3lDaGFyYWN0ZXJzID8/IFtdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2lnbnVwQXR0cmlidXRlczpcbiAgICAgICAgICAgICAgICAgIGNsaWVudENvbmZpZy5hd3NfY29nbml0b19zaWdudXBfYXR0cmlidXRlcyA/PyBbXSxcbiAgICAgICAgICAgICAgICB1c2VybmFtZUF0dHJpYnV0ZXM6XG4gICAgICAgICAgICAgICAgICBjbGllbnRDb25maWcuYXdzX2NvZ25pdG9fdXNlcm5hbWVfYXR0cmlidXRlcyA/PyBbXSxcbiAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25NZWNoYW5pc21zOlxuICAgICAgICAgICAgICAgICAgY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX3ZlcmlmaWNhdGlvbl9tZWNoYW5pc21zID8/IFtdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGlmIChjbGllbnRDb25maWcub2F1dGgpIHtcbiAgICAgICAgYXV0aENvbmZpZy5wbHVnaW5zLmF3c0NvZ25pdG9BdXRoUGx1Z2luLkF1dGguRGVmYXVsdC5PQXV0aCA9IHtcbiAgICAgICAgICBXZWJEb21haW46IGNsaWVudENvbmZpZy5vYXV0aC5kb21haW4sXG4gICAgICAgICAgU2NvcGVzOiBjbGllbnRDb25maWcub2F1dGguc2NvcGUsXG4gICAgICAgICAgU2lnbkluUmVkaXJlY3RVUkk6IGNsaWVudENvbmZpZy5vYXV0aC5yZWRpcmVjdFNpZ25JbixcbiAgICAgICAgICBTaWduT3V0UmVkaXJlY3RVUkk6IGNsaWVudENvbmZpZy5vYXV0aC5yZWRpcmVjdFNpZ25PdXQsXG4gICAgICAgICAgQXBwQ2xpZW50SWQ6IGNsaWVudENvbmZpZy5vYXV0aC5jbGllbnRJZCxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIG1vYmlsZUNvbmZpZy5hdXRoID0gYXV0aENvbmZpZztcbiAgICB9XG5cbiAgICBpZiAoY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2dyYXBocWxFbmRwb2ludCkge1xuICAgICAgY29uc3QgYXBpQ29uZmlnOiBDbGllbnRDb25maWdNb2JpbGVBcGkgPSB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICBhd3NBUElQbHVnaW46IHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgZW5kcG9pbnRUeXBlOiAnR3JhcGhRTCcsXG4gICAgICAgICAgICAgIGVuZHBvaW50OiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfZ3JhcGhxbEVuZHBvaW50LFxuICAgICAgICAgICAgICByZWdpb246IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19yZWdpb24sXG4gICAgICAgICAgICAgIGF1dGhvcml6YXRpb25UeXBlOiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYXV0aGVudGljYXRpb25UeXBlLFxuICAgICAgICAgICAgICBhcGlLZXk6IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19hcGlLZXksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgbW9iaWxlQ29uZmlnLmFwaSA9IGFwaUNvbmZpZztcblxuICAgICAgaWYgKG1vYmlsZUNvbmZpZy5hdXRoKSB7XG4gICAgICAgIGxldCBkZWZhdWx0Q2xpZW50RGF0YWJhc2VQcmVmaXggPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYXV0aGVudGljYXRpb25UeXBlKSB7XG4gICAgICAgICAgZGVmYXVsdENsaWVudERhdGFiYXNlUHJlZml4ID0gYGRhdGFfJHtjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYXV0aGVudGljYXRpb25UeXBlfWA7XG4gICAgICAgIH1cbiAgICAgICAgbW9iaWxlQ29uZmlnLmF1dGgucGx1Z2lucy5hd3NDb2duaXRvQXV0aFBsdWdpbi5BcHBTeW5jID0ge1xuICAgICAgICAgIERlZmF1bHQ6IHtcbiAgICAgICAgICAgIEFwaVVybDogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2dyYXBocWxFbmRwb2ludCxcbiAgICAgICAgICAgIFJlZ2lvbjogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX3JlZ2lvbixcbiAgICAgICAgICAgIEF1dGhNb2RlOiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYXV0aGVudGljYXRpb25UeXBlLFxuICAgICAgICAgICAgQXBpS2V5OiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYXBpS2V5LFxuICAgICAgICAgICAgQ2xpZW50RGF0YWJhc2VQcmVmaXg6IGRlZmF1bHRDbGllbnREYXRhYmFzZVByZWZpeCxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICBpZiAoY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2FkZGl0aW9uYWxBdXRoZW50aWNhdGlvblR5cGVzKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBhZGRpdGlvbmFsQXV0aGVudGljYXRpb25UeXBlIG9mIGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19hZGRpdGlvbmFsQXV0aGVudGljYXRpb25UeXBlcy5zcGxpdChcbiAgICAgICAgICAgICcsJ1xuICAgICAgICAgICkpIHtcbiAgICAgICAgICAgIG1vYmlsZUNvbmZpZy5hdXRoLnBsdWdpbnMuYXdzQ29nbml0b0F1dGhQbHVnaW4uQXBwU3luY1tcbiAgICAgICAgICAgICAgYGRhdGFfJHthZGRpdGlvbmFsQXV0aGVudGljYXRpb25UeXBlfWBcbiAgICAgICAgICAgIF0gPSB7XG4gICAgICAgICAgICAgIEFwaVVybDogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2dyYXBocWxFbmRwb2ludCxcbiAgICAgICAgICAgICAgUmVnaW9uOiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfcmVnaW9uLFxuICAgICAgICAgICAgICBBdXRoTW9kZTogYWRkaXRpb25hbEF1dGhlbnRpY2F0aW9uVHlwZSxcbiAgICAgICAgICAgICAgQXBpS2V5OiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYXBpS2V5LFxuICAgICAgICAgICAgICBDbGllbnREYXRhYmFzZVByZWZpeDogYGRhdGFfJHthZGRpdGlvbmFsQXV0aGVudGljYXRpb25UeXBlfWAsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjbGllbnRDb25maWcuZ2VvKSB7XG4gICAgICBjb25zdCBnZW9Db25maWc6IENsaWVudENvbmZpZ01vYmlsZUdlbyA9IHtcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgIGF3c0xvY2F0aW9uR2VvUGx1Z2luOiB7XG4gICAgICAgICAgICByZWdpb246IGNsaWVudENvbmZpZy5nZW8uYW1hem9uX2xvY2F0aW9uX3NlcnZpY2UucmVnaW9uLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtYXBzID0gY2xpZW50Q29uZmlnLmdlby5hbWF6b25fbG9jYXRpb25fc2VydmljZS5tYXBzO1xuICAgICAgaWYgKG1hcHMpIHtcbiAgICAgICAgZ2VvQ29uZmlnLnBsdWdpbnMuYXdzTG9jYXRpb25HZW9QbHVnaW4ubWFwcyA9IG1hcHM7XG4gICAgICB9XG4gICAgICBjb25zdCBzZWFyY2hJbmRpY2VzID1cbiAgICAgICAgY2xpZW50Q29uZmlnLmdlby5hbWF6b25fbG9jYXRpb25fc2VydmljZS5zZWFyY2hfaW5kaWNlcztcbiAgICAgIGlmIChzZWFyY2hJbmRpY2VzKSB7XG4gICAgICAgIGdlb0NvbmZpZy5wbHVnaW5zLmF3c0xvY2F0aW9uR2VvUGx1Z2luLnNlYXJjaEluZGljZXMgPSBzZWFyY2hJbmRpY2VzO1xuICAgICAgfVxuXG4gICAgICBtb2JpbGVDb25maWcuZ2VvID0gZ2VvQ29uZmlnO1xuICAgIH1cblxuICAgIGlmIChjbGllbnRDb25maWcuQW5hbHl0aWNzKSB7XG4gICAgICBtb2JpbGVDb25maWcuYW5hbHl0aWNzID0ge1xuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgYXdzUGlucG9pbnRBbmFseXRpY3NQbHVnaW46IHtcbiAgICAgICAgICAgIHBpbnBvaW50QW5hbHl0aWNzOiB7XG4gICAgICAgICAgICAgIHJlZ2lvbjogY2xpZW50Q29uZmlnLkFuYWx5dGljcy5QaW5wb2ludC5yZWdpb24sXG4gICAgICAgICAgICAgIGFwcElkOiBjbGllbnRDb25maWcuQW5hbHl0aWNzLlBpbnBvaW50LmFwcElkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBpbnBvaW50VGFyZ2V0aW5nOiB7XG4gICAgICAgICAgICAgIHJlZ2lvbjogY2xpZW50Q29uZmlnLkFuYWx5dGljcy5QaW5wb2ludC5yZWdpb24sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucykge1xuICAgICAgbW9iaWxlQ29uZmlnLm5vdGlmaWNhdGlvbnMgPSB7XG4gICAgICAgIHBsdWdpbnM6IHt9LFxuICAgICAgfTtcbiAgICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5TTVMpIHtcbiAgICAgICAgbW9iaWxlQ29uZmlnLm5vdGlmaWNhdGlvbnMucGx1Z2lucy5hd3NQaW5wb2ludFNtc05vdGlmaWNhdGlvbnNQbHVnaW4gPVxuICAgICAgICAgIGNsaWVudENvbmZpZy5Ob3RpZmljYXRpb25zLlNNUy5BV1NQaW5wb2ludDtcbiAgICAgIH1cbiAgICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5FTUFJTCkge1xuICAgICAgICBtb2JpbGVDb25maWcubm90aWZpY2F0aW9ucy5wbHVnaW5zLmF3c1BpbnBvaW50RW1haWxOb3RpZmljYXRpb25zUGx1Z2luID1cbiAgICAgICAgICBjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5FTUFJTC5BV1NQaW5wb2ludDtcbiAgICAgIH1cbiAgICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5JbkFwcE1lc3NhZ2luZykge1xuICAgICAgICBtb2JpbGVDb25maWcubm90aWZpY2F0aW9ucy5wbHVnaW5zLmF3c1BpbnBvaW50SW5BcHBNZXNzYWdpbmdOb3RpZmljYXRpb25zUGx1Z2luID1cbiAgICAgICAgICBjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5JbkFwcE1lc3NhZ2luZy5BV1NQaW5wb2ludDtcbiAgICAgIH1cbiAgICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5QdXNoKSB7XG4gICAgICAgIG1vYmlsZUNvbmZpZy5ub3RpZmljYXRpb25zLnBsdWdpbnMuYXdzUGlucG9pbnRQdXNoTm90aWZpY2F0aW9uc1BsdWdpbiA9XG4gICAgICAgICAgY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMuUHVzaC5BV1NQaW5wb2ludDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2xpZW50Q29uZmlnLmF3c191c2VyX2ZpbGVzX3MzX2J1Y2tldCkge1xuICAgICAgbW9iaWxlQ29uZmlnLnN0b3JhZ2UgPSB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICBhd3NTM1N0b3JhZ2VQbHVnaW46IHtcbiAgICAgICAgICAgIGJ1Y2tldDogY2xpZW50Q29uZmlnLmF3c191c2VyX2ZpbGVzX3MzX2J1Y2tldCxcbiAgICAgICAgICAgIHJlZ2lvbjogY2xpZW50Q29uZmlnLmF3c191c2VyX2ZpbGVzX3MzX2J1Y2tldF9yZWdpb24sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIG1vYmlsZUNvbmZpZztcbiAgfTtcbn1cbiJdfQ==